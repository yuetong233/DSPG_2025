<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Yuetong Zhang">

<title>DSPG Workshop - Introduction to Remote Sensing and Google Earth Engine</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">DSPG Workshop</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html" rel="" target="">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../code/api_call.html" rel="" target="">
 <span class="menu-text">API Call</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="../code/rs_intro.html" rel="" target="" aria-current="page">
 <span class="menu-text">Remote Sensing</span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools ms-auto">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#what-is-remote-sensing" id="toc-what-is-remote-sensing" class="nav-link active" data-scroll-target="#what-is-remote-sensing">0. What is Remote Sensing</a></li>
  <li><a href="#getting-started" id="toc-getting-started" class="nav-link" data-scroll-target="#getting-started">1. Getting Started</a>
  <ul class="collapse">
  <li><a href="#overview" id="toc-overview" class="nav-link" data-scroll-target="#overview">Overview</a></li>
  </ul></li>
  <li><a href="#core-components-of-google-earth-engine-operations" id="toc-core-components-of-google-earth-engine-operations" class="nav-link" data-scroll-target="#core-components-of-google-earth-engine-operations">2. Core Components of Google Earth Engine Operations</a>
  <ul class="collapse">
  <li><a href="#images-and-image-collections" id="toc-images-and-image-collections" class="nav-link" data-scroll-target="#images-and-image-collections">2.1 Images and Image Collections</a>
  <ul class="collapse">
  <li><a href="#images" id="toc-images" class="nav-link" data-scroll-target="#images">Images</a></li>
  <li><a href="#image-collections" id="toc-image-collections" class="nav-link" data-scroll-target="#image-collections">Image Collections</a></li>
  <li><a href="#sensed-versus-derived-imagery" id="toc-sensed-versus-derived-imagery" class="nav-link" data-scroll-target="#sensed-versus-derived-imagery">Sensed versus Derived Imagery</a></li>
  </ul></li>
  <li><a href="#geometries" id="toc-geometries" class="nav-link" data-scroll-target="#geometries">2.2 Geometries</a></li>
  <li><a href="#features-and-boundries" id="toc-features-and-boundries" class="nav-link" data-scroll-target="#features-and-boundries">2.3 Features and Boundries</a>
  <ul class="collapse">
  <li><a href="#features" id="toc-features" class="nav-link" data-scroll-target="#features">Features</a></li>
  <li><a href="#boundaries" id="toc-boundaries" class="nav-link" data-scroll-target="#boundaries">Boundaries</a></li>
  </ul></li>
  <li><a href="#arrays" id="toc-arrays" class="nav-link" data-scroll-target="#arrays">2.4 Arrays</a></li>
  <li><a href="#methods-reducers-and-joins" id="toc-methods-reducers-and-joins" class="nav-link" data-scroll-target="#methods-reducers-and-joins">2.5 Methods: Reducers and Joins</a>
  <ul class="collapse">
  <li><a href="#reducers" id="toc-reducers" class="nav-link" data-scroll-target="#reducers">Reducers</a></li>
  <li><a href="#join" id="toc-join" class="nav-link" data-scroll-target="#join">Join</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#physical-bases-of-remote-sensing" id="toc-physical-bases-of-remote-sensing" class="nav-link" data-scroll-target="#physical-bases-of-remote-sensing">3. Physical Bases of Remote Sensing</a>
  <ul class="collapse">
  <li><a href="#four-types-of-resolution" id="toc-four-types-of-resolution" class="nav-link" data-scroll-target="#four-types-of-resolution">Four Types of Resolution</a></li>
  </ul></li>
  <li><a href="#time-series-plots" id="toc-time-series-plots" class="nav-link" data-scroll-target="#time-series-plots">4. Time Series Plots</a>
  <ul class="collapse">
  <li><a href="#data-preparation" id="toc-data-preparation" class="nav-link" data-scroll-target="#data-preparation">Data Preparation</a></li>
  <li><a href="#vegetation-index" id="toc-vegetation-index" class="nav-link" data-scroll-target="#vegetation-index">Vegetation Index</a></li>
  <li><a href="#agriculture-phenology" id="toc-agriculture-phenology" class="nav-link" data-scroll-target="#agriculture-phenology">Agriculture Phenology</a></li>
  <li><a href="#data-visualization" id="toc-data-visualization" class="nav-link" data-scroll-target="#data-visualization">Data Visualization</a></li>
  <li><a href="#export-data-as-a-csv-file-to-google-drive" id="toc-export-data-as-a-csv-file-to-google-drive" class="nav-link" data-scroll-target="#export-data-as-a-csv-file-to-google-drive">Export Data as a CSV File to Google Drive</a></li>
  <li><a href="#additional-resources" id="toc-additional-resources" class="nav-link" data-scroll-target="#additional-resources">Additional Resources</a></li>
  </ul></li>
  <li><a href="#raster-images-v.s.-vector-images" id="toc-raster-images-v.s.-vector-images" class="nav-link" data-scroll-target="#raster-images-v.s.-vector-images">5. Raster Images v.s. Vector Images</a>
  <ul class="collapse">
  <li><a href="#brief-summary" id="toc-brief-summary" class="nav-link" data-scroll-target="#brief-summary">Brief Summary</a></li>
  <li><a href="#analytical-capability" id="toc-analytical-capability" class="nav-link" data-scroll-target="#analytical-capability">Analytical Capability</a></li>
  <li><a href="#practical-examples" id="toc-practical-examples" class="nav-link" data-scroll-target="#practical-examples">Practical Examples</a></li>
  </ul></li>
  <li><a href="#find-a-suitable-remote-sensing-data" id="toc-find-a-suitable-remote-sensing-data" class="nav-link" data-scroll-target="#find-a-suitable-remote-sensing-data">6. Find a Suitable Remote Sensing Data</a></li>
  <li><a href="#optional-set-gee-api-through-rstudio" id="toc-optional-set-gee-api-through-rstudio" class="nav-link" data-scroll-target="#optional-set-gee-api-through-rstudio">Optional: Set GEE API through RStudio</a>
  <ul class="collapse">
  <li><a href="#o.1.-set-python-environment-in-terminal" id="toc-o.1.-set-python-environment-in-terminal" class="nav-link" data-scroll-target="#o.1.-set-python-environment-in-terminal">O.1. Set Python environment in terminal</a></li>
  <li><a href="#o.2.-connect-rstudio-with-existing-python-environment" id="toc-o.2.-connect-rstudio-with-existing-python-environment" class="nav-link" data-scroll-target="#o.2.-connect-rstudio-with-existing-python-environment">O.2. Connect RStudio with existing python environment</a></li>
  <li><a href="#o.3.-set-google-drive" id="toc-o.3.-set-google-drive" class="nav-link" data-scroll-target="#o.3.-set-google-drive">O.3. Set Google drive</a></li>
  <li><a href="#o.4.-to-run-gee-in-the-desired-python-path" id="toc-o.4.-to-run-gee-in-the-desired-python-path" class="nav-link" data-scroll-target="#o.4.-to-run-gee-in-the-desired-python-path">O.4. To run GEE in the desired python path</a></li>
  <li><a href="#o.5.-use-rgee-inside-shiny-apps" id="toc-o.5.-use-rgee-inside-shiny-apps" class="nav-link" data-scroll-target="#o.5.-use-rgee-inside-shiny-apps">O.5. Use rgee inside Shiny apps</a></li>
  <li><a href="#o.6.-connect-gee-data-with-nass-data" id="toc-o.6.-connect-gee-data-with-nass-data" class="nav-link" data-scroll-target="#o.6.-connect-gee-data-with-nass-data">O.6. Connect GEE data with NASS data</a></li>
  <li><a href="#o.7.-connect-gee-data-with-acs-data" id="toc-o.7.-connect-gee-data-with-acs-data" class="nav-link" data-scroll-target="#o.7.-connect-gee-data-with-acs-data">O.7. Connect GEE data with ACS data</a></li>
  </ul></li>
  </ul>
</nav>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Introduction to Remote Sensing and Google Earth Engine</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Yuetong Zhang </p>
          </div>
  </div>
    
  
    
  </div>
  

</header>

<p><strong>Acknowledgment:</strong> I am grateful to Dr.&nbsp;Elinor Benami for the original lecture and lab materials, used here under the Creative Commons License (Attribution-NonCommercial-ShareAlike 4.0 International). Modifications have been made to the context and code of the original content.</p>
<section id="what-is-remote-sensing" class="level1 unnumbered">
<h1 class="unnumbered">0. What is Remote Sensing</h1>
<p>Acquiring information from a distance—particularly when information is derived from radiation in one or more parts of the electromagnetic spectrum, either reflected or emitted from the Earth’s surface.</p>
<p>Advantages of using remotely sensed data:</p>
<ul>
<li>Relatively inexpensive</li>
<li>Systematic data collection</li>
<li>Repetitive observations over time</li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="figures/remote-sensing-process.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Satellite Process</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="figures/electromagnetic-spectrum.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Electromagnetic Spectrum</figcaption>
</figure>
</div>
</section>
<section id="getting-started" class="level1 unnumbered">
<h1 class="unnumbered">1. Getting Started</h1>
<section id="overview" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="overview">Overview</h2>
<p>The purpose of this workshop is to introduce the functionality and structure of Google Earth Engine (GEE) that may support your projects. This tutorial provides a brief overview of the GEE JavaScript interface (Code Editor), imagery data formats, the four types of sensor resolution, time series plots, and how to use RStudio to remotely access GEE resources. For the registration process, please use your <strong>personal Google account</strong> to access GEE.</p>
<section id="learning-outcomes" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="learning-outcomes">Learning Outcomes</h4>
<ul>
<li>Navigate basic Google Earth Engine (GEE) resources</li>
<li>Describe the major GEE data types and their associated methods</li>
<li>Create and visualize composites based on desired parameters</li>
<li>Obtain climate-related data, land cover information, and vegetation indices</li>
<li>Access GEE remotely through RStudio</li>
</ul>
</section>
<section id="setting-up-an-account" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="setting-up-an-account">Setting up an Account</h4>
<p>To get started, sign up for <a href="https://signup.earthengine.google.com">Google Earth Engine</a>. Registration is free and straightforward, but it takes approximately 24 hours to be approved to use the code editor.</p>
</section>
<section id="importing-data" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="importing-data">Importing data</h4>
<p>In addition to providing access to petabytes of satellite imagery and geospatial products, Google Earth Engine (GEE) also enables users to upload and work with their own <a href="https://developers.google.com/earth-engine/guides/image_upload">raster</a>, <a href="https://developers.google.com/earth-engine/guides/table_upload">vector, and tabular data</a>. These <a href="https://developers.google.com/earth-engine/guides/asset_manager">user-provided assets</a> can be seamlessly integrated into analyses. This process is automatically linked to the <a href="https://developers.google.com/earth-engine/guides/exporting">Google Drive account</a> associated with the GEE user account.</p>
<p><strong>Note that most commonly used export formats in GEE are <code>.tif</code>, <code>.shp</code>, <code>.geojson</code> and <code>.csv</code>files</strong></p>
</section>
<section id="gee-processes-on-google-cloud-platform" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="gee-processes-on-google-cloud-platform">GEE processes on Google Cloud Platform</h4>
<p>When you open the Code Editor in your browser, you can write and run JavaScript code locally. To access GEE’s cloud computing resources, you can use server-side functions. For example, the <code>ee</code> prefix before the <code>ImageCollection</code> tells Earth Engine to process the data on its servers. Without that indicator, GEE will cede operations to the server. The satellite image collections listed below include sensors that capture climate variables, surface reflectance data, and processed (derived) products such as land cover classifications.</p>
<p>If we want to access climate-related data, including temperature and precipitation, we can use the <a href="https://developers.google.com/earth-engine/datasets/catalog/MODIS_061_MOD11A1">MODIS Land Surface Temperature (LST)</a> and write the following code:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode javascript code-with-copy"><code class="sourceCode javascript"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> modisLST <span class="op">=</span> ee<span class="op">.</span><span class="fu">ImageCollection</span>(<span class="st">'MODIS/061/MOD11A1'</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>To compute vegetation or surface indices using land surface reflectance data, we can use the <a href="https://developers.google.com/earth-engine/datasets/catalog/LANDSAT_LC08_C02_T1_L2?hl=en#description">Landsat8 Surface Reflectance data</a> and implement the following code:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode javascript code-with-copy"><code class="sourceCode javascript"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> landsat8Sr <span class="op">=</span> ee<span class="op">.</span><span class="fu">ImageCollection</span>(<span class="st">'LANDSAT/LC08/C02/T1_L2'</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>To obtain a Land Use/Land Cover (LULC) dataset with class probabilities and label information for nine land cover types, we can use the <a href="https://developers.google.com/earth-engine/datasets/catalog/GOOGLE_DYNAMICWORLD_V1#description">Dynamic World V1</a> dataset and write the following code:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode javascript code-with-copy"><code class="sourceCode javascript"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> dynamicv1 <span class="op">=</span> ee<span class="op">.</span><span class="fu">ImageCollection</span>(<span class="st">'GOOGLE/DYNAMICWORLD/V1'</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="javascript" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="javascript">JavaScript</h4>
<p>Several resources can help you in working with JavaScript.</p>
<ul>
<li><p><a href="https://javascript.info">Javascript.info</a> provides a comprehensive guide; focus on Part I for this tutorial.</p></li>
<li><p><a href="https://www.w3schools.com/js/default.asp">W3Schools</a> offers clear explanations of individual JavaScript components.</p></li>
<li><p><a href="http://www.javascriptbook.com">JavaScript &amp; JQuery</a> is a well-designed book with fundamentals, illustrations, and practical examples.</p></li>
</ul>
</section>
</section>
</section>
<section id="core-components-of-google-earth-engine-operations" class="level1 unnumbered">
<h1 class="unnumbered">2. Core Components of Google Earth Engine Operations</h1>
<p>Most Google Earth Engine tutorials begin with an introduction to the data structures and the operations you can use to analyze your data structures. To work effectively with GEE, it is essential that you understand these core components and how to complete basic operations with each of them.</p>
<p><a href="https://developers.google.com/earth-engine/guides">Intro to Data</a></p>
<section id="core-data-structures-in-gee" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="core-data-structures-in-gee">Core Data Structures in GEE</h4>
<ul>
<li><a href="https://developers.google.com/earth-engine/guides/image_overview"><code>Image</code></a>: A raster image, the fundamental data type in Earth Engine, often representing satellite data or other gridded variables.</li>
<li><a href="https://developers.google.com/earth-engine/guides/ic_creating"><code>ImageCollection</code></a>: A “stack” or sequence of images that share the same attributes (e.g., time series of satellite imagery).</li>
<li><a href="https://developers.google.com/earth-engine/guides/geometries"><code>Geometry</code></a>: Vector data representing spatial shapes (points, lines, polygons), either drawn within GEE or imported from external sources.</li>
<li><a href="https://developers.google.com/earth-engine/guides/features"><code>Feature</code></a>: A <code>geometry</code> paired with associated attribute data (e.g., a county boundary with associated land surface temperature values).</li>
<li><a href="https://developers.google.com/earth-engine/guides/feature_collections"><code>FeatureCollection</code></a>: A group of related features, often used to represent sets of regions, survey points, or administrative boundaries.</li>
<li><a href="https://developers.google.com/earth-engine/guides/arrays_intro"><code>Array</code></a>: A flexible, multi-dimensional data structure for numerical analyses—useful but can be inefficient for large-scale operations.</li>
</ul>
</section>
<section id="key-operations" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="key-operations">Key Operations</h4>
<ul>
<li><a href="https://developers.google.com/earth-engine/guides/reducers_intro"><code>Reducer</code></a>: A method used to compute statistics or perform aggregations on the data over space, time, bands, arrays, and other data structures (e.g., calculating mean, max, or standard deviation).</li>
<li><a href="https://developers.google.com/earth-engine/guides/joins_intro"><code>Join</code></a>: A method to combine two datasets (<code>Image</code> or <code>Feature</code> collections) based on shared attributes like time, location.</li>
</ul>
</section>
<section id="images-and-image-collections" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="images-and-image-collections">2.1 Images and Image Collections</h2>
<section id="images" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="images">Images</h3>
<p><strong>Images</strong> are <strong>Raster</strong> objects composed of one or more bands.</p>
<ul>
<li>Each band is essentially a layer of data with a unique:
<ul>
<li><strong>Name</strong>: A unique identifier for the band</li>
<li><strong>Data type</strong>: Specifies the format (e.g., integer, float)</li>
<li><strong>Scale</strong>: The spatial resolution (e.g., meters per pixel)</li>
<li><strong>Mask</strong>: Indicates which pixels are valid or missing</li>
<li><strong>Projection</strong>: Defines how the image is georeferenced</li>
</ul></li>
<li>Metadata, stored as a set of properties for that band.</li>
</ul>
<p>You can create images from constants (e.g., a fixed value across space), lists, or other objects. In the <strong>code editor “Docs” tab</strong>, you’ll find numerous processes that can be applied to images (e.g.&nbsp;masking, scaling, or visualizing).</p>
<p>Do not confuse an individual image with an image collection. An <strong>Image</strong> refers to a single raster dataset, whereas an <strong>ImageCollection</strong> is a set of images grouped together, most often as a time series, and often known as a <code>stack</code>.</p>
</section>
<section id="image-collections" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="image-collections">Image Collections</h3>
<p>The code below is an established method of extracting one individual image from an image collection. You can copy and paste this code into the GEE code editor.</p>
<p>On the first line, we see that we are creating a JavaScript variable named <code>collection</code> and assign it a <strong>Landsat 8 surface reflectance image collection</strong>. Then we use <code>ee</code> before <code>ImageCollection</code> to tell GEE to access data from its cloud-based servers. The dataset ‘LANDSAT/LC08/C02/T1_L2’ is the Landsat 8 Collection 2 Tier 1 Surface Reflectance product, which provides atmospherically corrected reflectance data from the <a href="https://developers.google.com/earth-engine/datasets/catalog/LANDSAT_LC08_C02_T1_L2?hl=en#description">OLI and TIRS sensors</a>.</p>
<p>The following steps further refine the extraction of an image from an image collection.</p>
<ol type="1">
<li><code>.select</code> selects the specific band from each image in the collection.</li>
<li><code>.filterBounds</code> filters data to the area specified, in this case a geometry Point that was created within GEE.</li>
<li><code>.filterDate</code> narrows the collection to images captured within a specific date range.</li>
<li><code>.first</code> is a JavaScript method of choosing the first image from a (potentially sorted) list. Often used after sorting by cloud cover to get the clearest image.</li>
</ol>
<p><code>Map.centerObject()</code> centers the map on the image, and the number is the amount of zoom. The higher that value is, the more zoomed in the image is - this often requires some trial-and-error to find a good fit.</p>
<p><code>Map.addLayer()</code> adds the visualization layer to the map. Each image or image collection has unique band names, so always refer to the documentation for the correct ones. GEE uses Red-Green-Blue band order for true-color visualization. <code>min</code> and <code>max</code> are the values that normalize the value of each pixel to the conventional 0-255 color scale. In this case, although the maximum value of a pixel in all three of those bands is 2000, for visualization purposes GEE will normalize that to 255, the max value in a standard 8-bit image.</p>
<p>There is a comprehensive <a href="https://developers.google.com/earth-engine/guides/image_visualization">guide</a> on imagery visualization covers topics like false-color composites, mosaicking, and single-band display.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode javascript code-with-copy"><code class="sourceCode javascript"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Load the Landsat 8 Tier 1 L2 SR</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> collection <span class="op">=</span> ee<span class="op">.</span><span class="fu">ImageCollection</span>(<span class="st">'LANDSAT/LC08/C02/T1_L2'</span>)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">filterBounds</span>(ee<span class="op">.</span><span class="at">Geometry</span><span class="op">.</span><span class="fu">Point</span>(<span class="op">-</span><span class="fl">80.4139</span><span class="op">,</span> <span class="fl">37.2296</span>))</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">filterDate</span>(<span class="st">'2024-01-01'</span><span class="op">,</span> <span class="st">'2024-01-31'</span>)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">sort</span>(<span class="st">'CLOUD_COVER'</span>)<span class="op">;</span>  <span class="co">// lowest cloud cover first</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> first <span class="op">=</span> collection<span class="op">.</span><span class="fu">first</span>()<span class="op">;</span> <span class="co">// Select the first (least‐cloudy) image</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">centerObject</span>(first<span class="op">,</span> <span class="dv">8</span>)<span class="op">;</span> <span class="co">// Center the map on that image</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="co">// Display the true-color SR bands</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(first<span class="op">,</span> {<span class="dt">bands</span><span class="op">:</span> [<span class="st">'SR_B4'</span><span class="op">,</span> <span class="st">'SR_B3'</span><span class="op">,</span> <span class="st">'SR_B2'</span>]<span class="op">,</span> <span class="dt">min</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> <span class="dt">max</span><span class="op">:</span> <span class="dv">3000</span>}<span class="op">,</span> <span class="st">'first'</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="sensed-versus-derived-imagery" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="sensed-versus-derived-imagery">Sensed versus Derived Imagery</h3>
<p>GEE provides a rich suite of dataset, and while many of them are traditional sensed imagery, others are <strong>derived dataset</strong>. For instance, the <a href="https://developers.google.com/earth-engine/datasets/catalog/GOOGLE_DYNAMICWORLD_V1#description">Dynamic World dataset</a> is generated from Sentinel-2 Level 1C imagery using machine learning. If you explore its “<strong>Band”</strong> information, you’ll find refined land cover classes representing specific surface types. Datasets like this often require different visualization techniques or approaches for mosaicking compared to raw imagery.</p>
<p>The code below uses the Dynamic World dataset to visualize land cover centered at Blacksburg from June to August 2024. Cropland (Class 4) is highlighted in green, and a full land cover layer displaying all nine classes is also included.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode javascript code-with-copy"><code class="sourceCode javascript"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Load the Dynamic World Image</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> point <span class="op">=</span> ee<span class="op">.</span><span class="at">Geometry</span><span class="op">.</span><span class="fu">Point</span>(<span class="op">-</span><span class="fl">80.4139</span><span class="op">,</span> <span class="fl">37.2296</span>)<span class="op">;</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> dwCollection <span class="op">=</span> ee<span class="op">.</span><span class="fu">ImageCollection</span>(<span class="st">'GOOGLE/DYNAMICWORLD/V1'</span>)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>                     <span class="op">.</span><span class="fu">filterBounds</span>(point) <span class="co">// Filter to the Blacksburg</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>                     <span class="op">.</span><span class="fu">filterDate</span>(<span class="st">'2024-06-01'</span><span class="op">,</span> <span class="st">'2024-08-31'</span>)<span class="op">;</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="co">// Check if the collection contains any images for the period and location</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> collectionSize <span class="op">=</span> dwCollection<span class="op">.</span><span class="fu">size</span>()<span class="op">;</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="co">// If images are found, create a composite and classify</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (collectionSize<span class="op">.</span><span class="fu">gt</span>(<span class="dv">0</span>)) { <span class="co">// Check if there's at least one image</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Dynamic World provides a 'label' band with the top classification.</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> dwImage <span class="op">=</span> dwCollection<span class="op">.</span><span class="fu">select</span>(<span class="st">'label'</span>)<span class="op">.</span><span class="fu">mode</span>()<span class="op">;</span> <span class="co">// Get the most frequent class</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Dynamic World classification: class 4 = Crops</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> agriculture <span class="op">=</span> dwImage<span class="op">.</span><span class="fu">eq</span>(<span class="dv">4</span>)<span class="op">;</span> <span class="co">// Binary image: 1 = cropland, 0 = other</span></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Define visualization parameters</span></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> visParams <span class="op">=</span> {</span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>    <span class="dt">min</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>    <span class="dt">max</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>    <span class="dt">palette</span><span class="op">:</span> [<span class="st">'white'</span><span class="op">,</span> <span class="st">'red'</span>] <span class="co">// non-agriculture = white, agriculture = green</span></span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Center the map on the point of interest with an appropriate zoom level</span></span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>  <span class="bu">Map</span><span class="op">.</span><span class="fu">centerObject</span>(point<span class="op">,</span> <span class="dv">10</span>)<span class="op">;</span> <span class="co">// Zoom level 10 is a suggestion, adjust as needed</span></span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>  <span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(agriculture<span class="op">.</span><span class="fu">selfMask</span>()<span class="op">,</span> visParams<span class="op">,</span> <span class="st">'Dynamic World Cropland (Class 4)'</span>)<span class="op">;</span> </span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Map.addLayer(agriculture, visParams, 'Dynamic World Cropland (Class 4)'); </span></span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Show both agriculture and non-agriculture lands</span></span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Add the Dynamic World composite label layer to see all classes</span></span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> dwVisParams <span class="op">=</span> {</span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a>    <span class="dt">min</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a>    <span class="dt">max</span><span class="op">:</span> <span class="dv">8</span><span class="op">,</span> <span class="co">// Dynamic World has 9 classes (0-8)</span></span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a>    <span class="dt">palette</span><span class="op">:</span> [</span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a>      <span class="st">'#419BDF'</span><span class="op">,</span> <span class="co">// Water</span></span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a>      <span class="st">'#397D49'</span><span class="op">,</span> <span class="co">// Trees</span></span>
<span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a>      <span class="st">'#88B053'</span><span class="op">,</span> <span class="co">// Grass</span></span>
<span id="cb5-40"><a href="#cb5-40" aria-hidden="true" tabindex="-1"></a>      <span class="st">'#7A87C6'</span><span class="op">,</span> <span class="co">// Flooded vegetation</span></span>
<span id="cb5-41"><a href="#cb5-41" aria-hidden="true" tabindex="-1"></a>      <span class="st">'#E49635'</span><span class="op">,</span> <span class="co">// Crops</span></span>
<span id="cb5-42"><a href="#cb5-42" aria-hidden="true" tabindex="-1"></a>      <span class="st">'#DFC35A'</span><span class="op">,</span> <span class="co">// Shrub and scrub</span></span>
<span id="cb5-43"><a href="#cb5-43" aria-hidden="true" tabindex="-1"></a>      <span class="st">'#C4281B'</span><span class="op">,</span> <span class="co">// Built area</span></span>
<span id="cb5-44"><a href="#cb5-44" aria-hidden="true" tabindex="-1"></a>      <span class="st">'#A59B8F'</span><span class="op">,</span> <span class="co">// Bare ground</span></span>
<span id="cb5-45"><a href="#cb5-45" aria-hidden="true" tabindex="-1"></a>      <span class="st">'#B39FE1'</span>  <span class="co">// Snow and ice</span></span>
<span id="cb5-46"><a href="#cb5-46" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb5-47"><a href="#cb5-47" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb5-48"><a href="#cb5-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-49"><a href="#cb5-49" aria-hidden="true" tabindex="-1"></a>  <span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(dwImage<span class="op">,</span> dwVisParams<span class="op">,</span> <span class="st">'Dynamic World Labels (Mode)'</span><span class="op">,</span> <span class="kw">false</span>)<span class="op">;</span> <span class="co">// Add as a hidden layer initially // The most likely reason no color appears in the image is cloud cover during the selected date range.</span></span>
<span id="cb5-50"><a href="#cb5-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-51"><a href="#cb5-51" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Center the map on the point of interest even if no data is found</span></span>
<span id="cb5-52"><a href="#cb5-52" aria-hidden="true" tabindex="-1"></a>  <span class="bu">Map</span><span class="op">.</span><span class="fu">centerObject</span>(point<span class="op">,</span> <span class="dv">9</span>)<span class="op">;</span></span>
<span id="cb5-53"><a href="#cb5-53" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-54"><a href="#cb5-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-55"><a href="#cb5-55" aria-hidden="true" tabindex="-1"></a><span class="co">// Add the point of interest to the map to verify location</span></span>
<span id="cb5-56"><a href="#cb5-56" aria-hidden="true" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(point<span class="op">,</span> {<span class="dt">color</span><span class="op">:</span> <span class="st">'green'</span>}<span class="op">,</span> <span class="st">'Point of Interest'</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="geometries" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="geometries">2.2 Geometries</h2>
<p>Google Earth Engine (GEE) handles vector data using the <strong>Geometry</strong> type. While it generally follows the traditional forms of vector data—Points, Lines, and Polygons—GEE includes some additional structure and terminology:</p>
<ul>
<li><a href="https://developers.google.com/earth-engine/apidocs/ee-geometry-point"><code>Point</code></a>: A single location defined by latitude and longitude.</li>
<li><a href="https://developers.google.com/earth-engine/apidocs/ee-geometry-linestring"><code>LineString</code></a>: A connected list of points that <u>does not</u> start and end at the same location; represents a linear path.</li>
<li><a href="https://developers.google.com/earth-engine/apidocs/ee-geometry-linearring"><code>LinearRing</code></a>: A closed version of a LineString that starts and ends at the same location; used to define polygon boundaries.</li>
<li><a href="https://developers.google.com/earth-engine/apidocs/ee-geometry-polygon"><code>Polygon</code></a>: A list of LinearRings. The first LinearRing defines the outer boundary (shell), and any additional LinearRings define interior holes (e.g., lakes or islands within the polygon).</li>
</ul>
<p>GEE also recognizes <a href="https://developers.google.com/earth-engine/apidocs/ee-geometry-multipoint"><code>MultiPoint</code></a>, <a href="https://developers.google.com/earth-engine/apidocs/ee-geometry-multilinestring"><code>MultiLineString</code></a> and <a href="https://developers.google.com/earth-engine/apidocs/ee-geometry-multipolygon"><code>MultiPolygon</code></a>, which are simply collections of more than one element. Additionally, you can combine any of these together to form a <a href="https://developers.google.com/earth-engine/apidocs/ee-algorithms-geometryconstructors-multigeometry"><code>MultiGeometry</code></a>.</p>
<p>Once you have a set of geometries, there are geospatial operations you can use for analysis, such as building buffer zones, area analysis, converting geometries to raster format (rasterization), etc. The <a href="https://developers.google.com/earth-engine/guides/geometric_operations">documentation</a> contains some basic examples to show you how to get started, although there are many more functions listed under the <strong>‘Docs’ tab</strong> in the Code Editor.</p>
<p>The following code demonstrates how to define a 30 km radius around a point in Blacksburg and compare urban area changes over time using imagery from both <a href="https://developers.google.com/earth-engine/datasets/catalog/LANDSAT_LT05_C02_T1_L2#description">LandSat 5</a> and <a href="https://developers.google.com/earth-engine/datasets/catalog/LANDSAT_LC08_C02_T1_L2">LandSat 8</a>. Landsat 5 provides historical data from 1984 to 2012, while Landsat 8 covers the period from 2013 to the present. To ensure a meaningful visual comparison, specific bands were selected from each satellite that are compatible in terms of wavelength and resolution.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode javascript code-with-copy"><code class="sourceCode javascript"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Setup: Blacksburg coordinates and Region of Interest (ROI)</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> blacksburgPoint <span class="op">=</span> ee<span class="op">.</span><span class="at">Geometry</span><span class="op">.</span><span class="fu">Point</span>([<span class="op">-</span><span class="fl">80.4139</span><span class="op">,</span> <span class="fl">37.2296</span>])<span class="op">;</span> <span class="co">// Longitude, Latitude</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> roi <span class="op">=</span> blacksburgPoint<span class="op">.</span><span class="fu">buffer</span>(<span class="dv">30000</span>)<span class="op">;</span> <span class="co">// 30km radius buffer</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="co">// Center the map on the ROI</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">centerObject</span>(roi<span class="op">,</span> <span class="dv">9</span>)<span class="op">;</span> <span class="co">// Zoom level 9 is a good starting point for 50km radius</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="co">// Define Time Periods</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> earlyPeriod <span class="op">=</span> {</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>  <span class="dt">start</span><span class="op">:</span> <span class="st">'2000-01-01'</span><span class="op">,</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>  <span class="dt">end</span><span class="op">:</span> <span class="st">'2004-12-31'</span><span class="op">,</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>  <span class="dt">label</span><span class="op">:</span> <span class="st">'2000-2004'</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> recentPeriod <span class="op">=</span> {</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>  <span class="dt">start</span><span class="op">:</span> <span class="st">'2019-01-01'</span><span class="op">,</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>  <span class="dt">end</span><span class="op">:</span> <span class="st">'2023-12-31'</span><span class="op">,</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>  <span class="dt">label</span><span class="op">:</span> <span class="st">'2019-2023'</span></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a><span class="co">// Image Preparation Function (Scaling and Cloud Masking for Landsat Collection 2 Level 2)</span></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">prepLandsatC2L2</span>(image) {</span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Apply scaling factors to optical bands.</span></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>  <span class="co">// See: https://developers.google.com/earth-engine/datasets/catalog/LANDSAT_LC08_C02_T1_L2#bands</span></span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> opticalBands <span class="op">=</span> image<span class="op">.</span><span class="fu">select</span>(<span class="st">'SR_B.'</span>)<span class="op">.</span><span class="fu">multiply</span>(<span class="fl">0.0000275</span>)<span class="op">.</span><span class="fu">add</span>(<span class="op">-</span><span class="fl">0.2</span>)<span class="op">;</span></span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Note: Thermal bands (ST_B*) would need different scaling if used.</span></span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Cloud and shadow masking using QA_PIXEL band</span></span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Bits (binary digits): 1 (Dilated Cloud), 3 (Cloud), 4 (Cloud Shadow), often used to encode quality flags for each pixel</span></span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>  <span class="co">// For example, if a pixel's QA value is 20, its binary representation is 10100.</span></span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a> <span class="co">// Reading from right to left (bit 0 to bit 4):</span></span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a><span class="co">// Bit 0: (unused), Bit 1: Dilated Cloud = 0, Bit 2: (unused), Bit 3: Cloud = 1, Bit 4: Cloud Shadow = 1</span></span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a><span class="co">// This means the pixel is flagged for both cloud and cloud shadow.</span></span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> qa <span class="op">=</span> image<span class="op">.</span><span class="fu">select</span>(<span class="st">'QA_PIXEL'</span>)<span class="op">;</span></span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> dilatedCloudBit <span class="op">=</span> <span class="dv">1</span> <span class="op">&lt;&lt;</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> cloudBit <span class="op">=</span> <span class="dv">1</span> <span class="op">&lt;&lt;</span> <span class="dv">3</span><span class="op">;</span></span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> cloudShadowBit <span class="op">=</span> <span class="dv">1</span> <span class="op">&lt;&lt;</span> <span class="dv">4</span><span class="op">;</span></span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Mask should be 0 for clear conditions.</span></span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> mask <span class="op">=</span> qa<span class="op">.</span><span class="fu">bitwiseAnd</span>(dilatedCloudBit)<span class="op">.</span><span class="fu">eq</span>(<span class="dv">0</span>)</span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">and</span>(qa<span class="op">.</span><span class="fu">bitwiseAnd</span>(cloudBit)<span class="op">.</span><span class="fu">eq</span>(<span class="dv">0</span>))</span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">and</span>(qa<span class="op">.</span><span class="fu">bitwiseAnd</span>(cloudShadowBit)<span class="op">.</span><span class="fu">eq</span>(<span class="dv">0</span>))<span class="op">;</span></span>
<span id="cb6-43"><a href="#cb6-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-44"><a href="#cb6-44" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Add scaled optical bands back to the image and apply the mask.</span></span>
<span id="cb6-45"><a href="#cb6-45" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Select only the scaled optical bands for the composite.</span></span>
<span id="cb6-46"><a href="#cb6-46" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> image<span class="op">.</span><span class="fu">addBands</span>(opticalBands<span class="op">,</span> <span class="kw">null</span><span class="op">,</span> <span class="kw">true</span>)</span>
<span id="cb6-47"><a href="#cb6-47" aria-hidden="true" tabindex="-1"></a>              <span class="op">.</span><span class="fu">updateMask</span>(mask)</span>
<span id="cb6-48"><a href="#cb6-48" aria-hidden="true" tabindex="-1"></a>              <span class="op">.</span><span class="fu">select</span>([<span class="st">'SR_B1'</span><span class="op">,</span> <span class="st">'SR_B2'</span><span class="op">,</span> <span class="st">'SR_B3'</span><span class="op">,</span> <span class="st">'SR_B4'</span><span class="op">,</span> <span class="st">'SR_B5'</span><span class="op">,</span> <span class="st">'SR_B7'</span>]<span class="op">,</span>  <span class="co">// L5 bands</span></span>
<span id="cb6-49"><a href="#cb6-49" aria-hidden="true" tabindex="-1"></a>                      [<span class="st">'SR_B1'</span><span class="op">,</span> <span class="st">'SR_B2'</span><span class="op">,</span> <span class="st">'SR_B3'</span><span class="op">,</span> <span class="st">'SR_B4'</span><span class="op">,</span> <span class="st">'SR_B5'</span><span class="op">,</span> <span class="st">'SR_B7'</span>])<span class="op">;</span> <span class="co">// L8 bands</span></span>
<span id="cb6-50"><a href="#cb6-50" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-51"><a href="#cb6-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-52"><a href="#cb6-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-53"><a href="#cb6-53" aria-hidden="true" tabindex="-1"></a><span class="co">// Load and Process Early Period Imagery (Landsat 5)</span></span>
<span id="cb6-54"><a href="#cb6-54" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> l5Collection <span class="op">=</span> ee<span class="op">.</span><span class="fu">ImageCollection</span>(<span class="st">'LANDSAT/LT05/C02/T1_L2'</span>)</span>
<span id="cb6-55"><a href="#cb6-55" aria-hidden="true" tabindex="-1"></a>                      <span class="op">.</span><span class="fu">filterBounds</span>(roi)</span>
<span id="cb6-56"><a href="#cb6-56" aria-hidden="true" tabindex="-1"></a>                      <span class="op">.</span><span class="fu">filterDate</span>(earlyPeriod<span class="op">.</span><span class="at">start</span><span class="op">,</span> earlyPeriod<span class="op">.</span><span class="at">end</span>)</span>
<span id="cb6-57"><a href="#cb6-57" aria-hidden="true" tabindex="-1"></a>                      <span class="op">.</span><span class="fu">map</span>(prepLandsatC2L2)<span class="op">;</span></span>
<span id="cb6-58"><a href="#cb6-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-59"><a href="#cb6-59" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> earlyComposite <span class="op">=</span> l5Collection<span class="op">.</span><span class="fu">median</span>()<span class="op">.</span><span class="fu">clip</span>(roi)<span class="op">;</span></span>
<span id="cb6-60"><a href="#cb6-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-61"><a href="#cb6-61" aria-hidden="true" tabindex="-1"></a><span class="co">// Load and Process Recent Period Imagery (Landsat 8)</span></span>
<span id="cb6-62"><a href="#cb6-62" aria-hidden="true" tabindex="-1"></a><span class="co">// Can also use LANDSAT/LC09/C02/T1_L2 or merge L8 and L9 for more data.</span></span>
<span id="cb6-63"><a href="#cb6-63" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> l8Collection <span class="op">=</span> ee<span class="op">.</span><span class="fu">ImageCollection</span>(<span class="st">'LANDSAT/LC08/C02/T1_L2'</span>)</span>
<span id="cb6-64"><a href="#cb6-64" aria-hidden="true" tabindex="-1"></a>                      <span class="op">.</span><span class="fu">filterBounds</span>(roi)</span>
<span id="cb6-65"><a href="#cb6-65" aria-hidden="true" tabindex="-1"></a>                      <span class="op">.</span><span class="fu">filterDate</span>(recentPeriod<span class="op">.</span><span class="at">start</span><span class="op">,</span> recentPeriod<span class="op">.</span><span class="at">end</span>)</span>
<span id="cb6-66"><a href="#cb6-66" aria-hidden="true" tabindex="-1"></a>                      <span class="op">.</span><span class="fu">map</span>(prepLandsatC2L2)<span class="op">;</span></span>
<span id="cb6-67"><a href="#cb6-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-68"><a href="#cb6-68" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> recentComposite <span class="op">=</span> l8Collection<span class="op">.</span><span class="fu">median</span>()<span class="op">.</span><span class="fu">clip</span>(roi)<span class="op">;</span></span>
<span id="cb6-69"><a href="#cb6-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-70"><a href="#cb6-70" aria-hidden="true" tabindex="-1"></a><span class="co">// Define Visualization Parameters for True Color</span></span>
<span id="cb6-71"><a href="#cb6-71" aria-hidden="true" tabindex="-1"></a><span class="co">// Reflectance values typically range from 0 to 1 after scaling.</span></span>
<span id="cb6-72"><a href="#cb6-72" aria-hidden="true" tabindex="-1"></a><span class="co">// We display values between 0.0 and 0.35 (or 0.4) for good contrast.</span></span>
<span id="cb6-73"><a href="#cb6-73" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> trueColorVisParams <span class="op">=</span> {</span>
<span id="cb6-74"><a href="#cb6-74" aria-hidden="true" tabindex="-1"></a>  <span class="dt">min</span><span class="op">:</span> <span class="fl">0.0</span><span class="op">,</span></span>
<span id="cb6-75"><a href="#cb6-75" aria-hidden="true" tabindex="-1"></a>  <span class="dt">max</span><span class="op">:</span> <span class="fl">0.35</span><span class="op">,</span> <span class="co">// Adjusted for better urban brightness</span></span>
<span id="cb6-76"><a href="#cb6-76" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb6-77"><a href="#cb6-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-78"><a href="#cb6-78" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> l5TrueColorVis <span class="op">=</span> {</span>
<span id="cb6-79"><a href="#cb6-79" aria-hidden="true" tabindex="-1"></a>  <span class="dt">bands</span><span class="op">:</span> [<span class="st">'SR_B3'</span><span class="op">,</span> <span class="st">'SR_B2'</span><span class="op">,</span> <span class="st">'SR_B1'</span>]<span class="op">,</span> <span class="co">// Red, Green, Blue for Landsat 5</span></span>
<span id="cb6-80"><a href="#cb6-80" aria-hidden="true" tabindex="-1"></a>  <span class="dt">min</span><span class="op">:</span> trueColorVisParams<span class="op">.</span><span class="at">min</span><span class="op">,</span></span>
<span id="cb6-81"><a href="#cb6-81" aria-hidden="true" tabindex="-1"></a>  <span class="dt">max</span><span class="op">:</span> trueColorVisParams<span class="op">.</span><span class="at">max</span></span>
<span id="cb6-82"><a href="#cb6-82" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb6-83"><a href="#cb6-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-84"><a href="#cb6-84" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> l8TrueColorVis <span class="op">=</span> {</span>
<span id="cb6-85"><a href="#cb6-85" aria-hidden="true" tabindex="-1"></a>  <span class="dt">bands</span><span class="op">:</span> [<span class="st">'SR_B4'</span><span class="op">,</span> <span class="st">'SR_B3'</span><span class="op">,</span> <span class="st">'SR_B2'</span>]<span class="op">,</span> <span class="co">// Red, Green, Blue for Landsat 8</span></span>
<span id="cb6-86"><a href="#cb6-86" aria-hidden="true" tabindex="-1"></a>  <span class="dt">min</span><span class="op">:</span> trueColorVisParams<span class="op">.</span><span class="at">min</span><span class="op">,</span></span>
<span id="cb6-87"><a href="#cb6-87" aria-hidden="true" tabindex="-1"></a>  <span class="dt">max</span><span class="op">:</span> trueColorVisParams<span class="op">.</span><span class="at">max</span></span>
<span id="cb6-88"><a href="#cb6-88" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb6-89"><a href="#cb6-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-90"><a href="#cb6-90" aria-hidden="true" tabindex="-1"></a><span class="co">// Add Layers to Map</span></span>
<span id="cb6-91"><a href="#cb6-91" aria-hidden="true" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(earlyComposite<span class="op">,</span> l5TrueColorVis<span class="op">,</span> <span class="st">'True Color '</span> <span class="op">+</span> earlyPeriod<span class="op">.</span><span class="at">label</span> <span class="op">+</span> <span class="st">' (L5)'</span>)<span class="op">;</span></span>
<span id="cb6-92"><a href="#cb6-92" aria-hidden="true" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(recentComposite<span class="op">,</span> l8TrueColorVis<span class="op">,</span> <span class="st">'True Color '</span> <span class="op">+</span> recentPeriod<span class="op">.</span><span class="at">label</span> <span class="op">+</span> <span class="st">' (L8)'</span>)<span class="op">;</span></span>
<span id="cb6-93"><a href="#cb6-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-94"><a href="#cb6-94" aria-hidden="true" tabindex="-1"></a><span class="co">// Add ROI outline to the map</span></span>
<span id="cb6-95"><a href="#cb6-95" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> empty <span class="op">=</span> ee<span class="op">.</span><span class="fu">Image</span>()<span class="op">.</span><span class="fu">byte</span>()<span class="op">;</span> <span class="co">// Create an empty image</span></span>
<span id="cb6-96"><a href="#cb6-96" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> roiOutline <span class="op">=</span> empty<span class="op">.</span><span class="fu">paint</span>({</span>
<span id="cb6-97"><a href="#cb6-97" aria-hidden="true" tabindex="-1"></a>  <span class="dt">featureCollection</span><span class="op">:</span> roi<span class="op">,</span></span>
<span id="cb6-98"><a href="#cb6-98" aria-hidden="true" tabindex="-1"></a>  <span class="dt">color</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="co">// arbitrary color, won't be shown</span></span>
<span id="cb6-99"><a href="#cb6-99" aria-hidden="true" tabindex="-1"></a>  <span class="dt">width</span><span class="op">:</span> <span class="dv">2</span>  <span class="co">// outline width</span></span>
<span id="cb6-100"><a href="#cb6-100" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb6-101"><a href="#cb6-101" aria-hidden="true" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(roiOutline<span class="op">,</span> {<span class="dt">palette</span><span class="op">:</span> <span class="st">'FF0000'</span>}<span class="op">,</span> <span class="st">'50km Radius ROI'</span>)<span class="op">;</span> <span class="co">// Red outline</span></span>
<span id="cb6-102"><a href="#cb6-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-103"><a href="#cb6-103" aria-hidden="true" tabindex="-1"></a><span class="co">// Print information to the console (optional)</span></span>
<span id="cb6-104"><a href="#cb6-104" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">'Early Period Composite (Landsat 5):'</span><span class="op">,</span> earlyComposite)<span class="op">;</span></span>
<span id="cb6-105"><a href="#cb6-105" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">'Recent Period Composite (Landsat 8):'</span><span class="op">,</span> recentComposite)<span class="op">;</span></span>
<span id="cb6-106"><a href="#cb6-106" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">'Region of Interest (50km radius around Blacksburg):'</span><span class="op">,</span> roi)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="features-and-boundries" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="features-and-boundries">2.3 Features and Boundries</h2>
<section id="features" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="features">Features</h3>
<p>At the most basic definition, a Feature in GEE is an object which stores a <code>geometry</code> property (<code>Point</code>, <code>Line</code>, <code>Polygon</code>) along with it’s associated properties. GEE uses the GeoJSON format to store and transmit these features.</p>
<p>Suppose we create an individual point that we want to associate with collected data. Based on the defined <code>point</code> variable, we can generate a surrounding square <code>geometry</code> and then create a <code>feature</code> using that geometry. The feature is assigned attribute values—in this case, latitude, longitude, and agricultural status. The resulting variable, <code>agriculture</code>, stores both the <strong>spatial information</strong> and the <strong>descriptive data</strong> for that location.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode javascript code-with-copy"><code class="sourceCode javascript"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Define the point and square polygon centered at Blacksburg</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> point <span class="op">=</span> ee<span class="op">.</span><span class="at">Geometry</span><span class="op">.</span><span class="fu">Point</span>(<span class="op">-</span><span class="fl">80.4139</span><span class="op">,</span> <span class="fl">37.2296</span>)<span class="op">;</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> squareSize <span class="op">=</span> <span class="dv">5000</span><span class="op">;</span> <span class="co">// meters</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> square <span class="op">=</span> point<span class="op">.</span><span class="fu">buffer</span>(squareSize)<span class="op">.</span><span class="fu">bounds</span>()<span class="op">;</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(square<span class="op">,</span> {<span class="dt">color</span><span class="op">:</span> <span class="st">'red'</span>}<span class="op">,</span> <span class="st">'Analysis Square'</span>)<span class="op">;</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">centerObject</span>(square<span class="op">,</span> <span class="dv">13</span>)<span class="op">;</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="co">// Load Dynamic World and compute mode composite</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> startDate <span class="op">=</span> <span class="st">'2024-06-01'</span><span class="op">;</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> endDate <span class="op">=</span> <span class="st">'2024-08-31'</span><span class="op">;</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> dwCollection <span class="op">=</span> ee<span class="op">.</span><span class="fu">ImageCollection</span>(<span class="st">'GOOGLE/DYNAMICWORLD/V1'</span>)</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">filterBounds</span>(square)</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">filterDate</span>(startDate<span class="op">,</span> endDate)<span class="op">;</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> dwImage <span class="op">=</span> dwCollection<span class="op">.</span><span class="fu">select</span>(<span class="st">'label'</span>)<span class="op">.</span><span class="fu">mode</span>()<span class="op">;</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> agriculture <span class="op">=</span> dwImage<span class="op">.</span><span class="fu">eq</span>(<span class="dv">4</span>)<span class="op">;</span> <span class="co">// 1 = Cropland</span></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(agriculture<span class="op">.</span><span class="fu">selfMask</span>()<span class="op">,</span> {<span class="dt">palette</span><span class="op">:</span> [<span class="st">'green'</span>]}<span class="op">,</span> <span class="st">'Cropland Mask'</span>)<span class="op">;</span></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a><span class="co">// Reduce to histogram</span></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> cropStats <span class="op">=</span> agriculture<span class="op">.</span><span class="fu">reduceRegion</span>({</span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>  <span class="dt">reducer</span><span class="op">:</span> ee<span class="op">.</span><span class="at">Reducer</span><span class="op">.</span><span class="fu">frequencyHistogram</span>()<span class="op">,</span></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>  <span class="dt">geometry</span><span class="op">:</span> square<span class="op">,</span></span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>  <span class="dt">scale</span><span class="op">:</span> <span class="dv">10</span><span class="op">,</span></span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>  <span class="dt">maxPixels</span><span class="op">:</span> <span class="fl">1e8</span></span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a><span class="co">// Evaluate and create a Feature</span></span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>cropStats<span class="op">.</span><span class="fu">evaluate</span>(<span class="kw">function</span>(result) {</span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> histogram <span class="op">=</span> result<span class="op">.</span><span class="at">label</span> <span class="op">||</span> {}<span class="op">;</span></span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> cropPixels <span class="op">=</span> histogram[<span class="st">'1'</span>] <span class="op">||</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> nonCropPixels <span class="op">=</span> histogram[<span class="st">'0'</span>] <span class="op">||</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> total <span class="op">=</span> cropPixels <span class="op">+</span> nonCropPixels<span class="op">;</span></span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> cropPercent <span class="op">=</span> total <span class="op">&gt;</span> <span class="dv">0</span> <span class="op">?</span> (cropPixels <span class="op">/</span> total) <span class="op">*</span> <span class="dv">100</span> <span class="op">:</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Print results</span></span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="st">'Cropland Pixels:'</span><span class="op">,</span> cropPixels)<span class="op">;</span></span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="st">'Cropland Coverage (%):'</span><span class="op">,</span> cropPercent<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">2</span>))<span class="op">;</span></span>
<span id="cb7-40"><a href="#cb7-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-41"><a href="#cb7-41" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Create an ee.Feature with square geometry and attributes</span></span>
<span id="cb7-42"><a href="#cb7-42" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> labeledFeature <span class="op">=</span> ee<span class="op">.</span><span class="fu">Feature</span>(square<span class="op">,</span> {</span>
<span id="cb7-43"><a href="#cb7-43" aria-hidden="true" tabindex="-1"></a>    <span class="dt">site_name</span><span class="op">:</span> <span class="st">'Point of Interest Alpha'</span><span class="op">,</span></span>
<span id="cb7-44"><a href="#cb7-44" aria-hidden="true" tabindex="-1"></a>    <span class="dt">latitude</span><span class="op">:</span> point<span class="op">.</span><span class="fu">coordinates</span>()<span class="op">.</span><span class="fu">get</span>(<span class="dv">1</span>)<span class="op">,</span></span>
<span id="cb7-45"><a href="#cb7-45" aria-hidden="true" tabindex="-1"></a>    <span class="dt">longitude</span><span class="op">:</span> point<span class="op">.</span><span class="fu">coordinates</span>()<span class="op">.</span><span class="fu">get</span>(<span class="dv">0</span>)<span class="op">,</span></span>
<span id="cb7-46"><a href="#cb7-46" aria-hidden="true" tabindex="-1"></a>    <span class="dt">start_date</span><span class="op">:</span> startDate<span class="op">,</span></span>
<span id="cb7-47"><a href="#cb7-47" aria-hidden="true" tabindex="-1"></a>    <span class="dt">end_date</span><span class="op">:</span> endDate<span class="op">,</span></span>
<span id="cb7-48"><a href="#cb7-48" aria-hidden="true" tabindex="-1"></a>    <span class="dt">crop_pixels</span><span class="op">:</span> cropPixels<span class="op">,</span></span>
<span id="cb7-49"><a href="#cb7-49" aria-hidden="true" tabindex="-1"></a>    <span class="dt">non_crop_pixels</span><span class="op">:</span> nonCropPixels<span class="op">,</span></span>
<span id="cb7-50"><a href="#cb7-50" aria-hidden="true" tabindex="-1"></a>    <span class="dt">total_pixels</span><span class="op">:</span> total<span class="op">,</span></span>
<span id="cb7-51"><a href="#cb7-51" aria-hidden="true" tabindex="-1"></a>    <span class="dt">cropland_percent</span><span class="op">:</span> cropPercent<span class="op">,</span></span>
<span id="cb7-52"><a href="#cb7-52" aria-hidden="true" tabindex="-1"></a>    <span class="dt">data_source</span><span class="op">:</span> <span class="st">'GOOGLE/DYNAMICWORLD/V1'</span></span>
<span id="cb7-53"><a href="#cb7-53" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb7-54"><a href="#cb7-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-55"><a href="#cb7-55" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Add it to a FeatureCollection so it can be exported or mapped</span></span>
<span id="cb7-56"><a href="#cb7-56" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> fc <span class="op">=</span> ee<span class="op">.</span><span class="fu">FeatureCollection</span>([labeledFeature])<span class="op">;</span></span>
<span id="cb7-57"><a href="#cb7-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="st">'🧾 Feature with cropland coverage:'</span><span class="op">,</span> fc)<span class="op">;</span></span>
<span id="cb7-58"><a href="#cb7-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-59"><a href="#cb7-59" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Map visualization (colored point or polygon)</span></span>
<span id="cb7-60"><a href="#cb7-60" aria-hidden="true" tabindex="-1"></a>  <span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(labeledFeature<span class="op">,</span> {<span class="dt">color</span><span class="op">:</span> <span class="st">'orange'</span>}<span class="op">,</span> <span class="st">'Labeled Analysis Feature'</span>)<span class="op">;</span></span>
<span id="cb7-61"><a href="#cb7-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-62"><a href="#cb7-62" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Export to Google Drive as CSV</span></span>
<span id="cb7-63"><a href="#cb7-63" aria-hidden="true" tabindex="-1"></a>  Export<span class="op">.</span><span class="at">table</span><span class="op">.</span><span class="fu">toDrive</span>({</span>
<span id="cb7-64"><a href="#cb7-64" aria-hidden="true" tabindex="-1"></a>    <span class="dt">collection</span><span class="op">:</span> fc<span class="op">,</span></span>
<span id="cb7-65"><a href="#cb7-65" aria-hidden="true" tabindex="-1"></a>    <span class="dt">description</span><span class="op">:</span> <span class="st">'Cropland_Percent_Square_Polygon'</span><span class="op">,</span></span>
<span id="cb7-66"><a href="#cb7-66" aria-hidden="true" tabindex="-1"></a>    <span class="dt">fileFormat</span><span class="op">:</span> <span class="st">'CSV'</span></span>
<span id="cb7-67"><a href="#cb7-67" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb7-68"><a href="#cb7-68" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Once you have information in a <code>Feature</code>, you can filter it to find specific information, such as the name of an object or based on the size of a polygon, or provide aggregated analysis. The <a href="https://developers.google.com/earth-engine/guides/features">documentation</a> on working with Feature Collections is comprehensive, and provides many ideas on how to use them efficiently in your analysis.</p>
</section>
<section id="boundaries" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="boundaries">Boundaries</h3>
<p>In Google Earth Engine, a boundary refers to the area represented by a polygon—commonly used to define the spatial extent for analyzing satellite or other geospatial data. Boundaries in GEE are stored as polygon geometries within <code>ee.Feature</code> or <code>ee.FeatureCollection</code> objects and can include additional attribute information.</p>
<p>You can either</p>
<ul>
<li>Load your own shapefiles or GeoJSONs as assets</li>
<li>Import administrative boundaries, such as countries or counties, from GEE-hosted datasets</li>
</ul>
<p>The following code loads the TIGER/Line state boundaries and specifically filters for the state of Virginia.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode javascript code-with-copy"><code class="sourceCode javascript"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Load TIGER/Line state boundaries from GEE</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> states <span class="op">=</span> ee<span class="op">.</span><span class="fu">FeatureCollection</span>(<span class="st">'TIGER/2018/States'</span>)<span class="op">;</span> </span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> virginia <span class="op">=</span> states<span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">eq</span>(<span class="st">'NAME'</span><span class="op">,</span> <span class="st">'Virginia'</span>))<span class="op">;</span> <span class="co">// Filter to Virginia using its state FIPS code (51) or name</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">centerObject</span>(virginia<span class="op">,</span> <span class="dv">7</span>)<span class="op">;</span> <span class="co">// Set the zoom level to 7</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(virginia<span class="op">,</span> {<span class="dt">color</span><span class="op">:</span> <span class="st">'black'</span>}<span class="op">,</span> <span class="st">'Virginia Boundary'</span>)<span class="op">;</span> <span class="co">// Center the map and add the boundary</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<section id="combine-the-pixels-within-a-certain-boundary" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="combine-the-pixels-within-a-certain-boundary">Combine the Pixels within A Certain Boundary</h4>
<p>Combining or summarizing pixels within a specific boundary in GEE is a common task for extracting zonal statistics (e.g., mean NDVI within a county). This involves reducing the pixel-level data by region.</p>
<p>Key functions include:</p>
<ol type="1">
<li><code>ee.Reducer.mean()</code> calculates the mean of pixel values.</li>
<li><code>geometry</code> or <code>featureCollection</code> defines the boundary/region.</li>
<li><code>reduceRegion()</code> or <code>reduceRegions()</code> to reduce data over one or multiple geometries.</li>
</ol>
<p>The following code show the case to use <a href="https://developers.google.com/earth-engine/datasets/catalog/MODIS_061_MOD11A1">MODIS (Terra Land Surface Temperature and Emissivity Daily Global 1km)</a> to compute the weekly averaged Land Surface Temperature (LST) for the entire Virginia from January to March 2024.</p>
<p>We first collect temperature data from each pixel within the desired time period and overlay it with the state boundary. For each week, a mean LST image is computed, converted to Celsius, and multiplied by a fractional mask to isolate pixel values within the boundary. Pixels with at least 50% of their area inside the boundary are included in the analysis.The area-weighted mean is then calculated by dividing the sum of weighted LST values by the sum of the mask values.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode javascript code-with-copy"><code class="sourceCode javascript"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Load Virginia boundary</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> states <span class="op">=</span> ee<span class="op">.</span><span class="fu">FeatureCollection</span>(<span class="st">'TIGER/2018/States'</span>)<span class="op">;</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> virginiaFc <span class="op">=</span> states<span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">eq</span>(<span class="st">'NAME'</span><span class="op">,</span> <span class="st">'Virginia'</span>))<span class="op">;</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> virginia <span class="op">=</span> virginiaFc<span class="op">.</span><span class="fu">geometry</span>()<span class="op">;</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="co">// Set time range</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> startDate <span class="op">=</span> ee<span class="op">.</span><span class="fu">Date</span>(<span class="st">'2024-01-01'</span>)<span class="op">;</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> endDate <span class="op">=</span> ee<span class="op">.</span><span class="fu">Date</span>(<span class="st">'2024-03-31'</span>)<span class="op">;</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a><span class="co">// Load MODIS Terra LST (daytime band)</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> modis <span class="op">=</span> ee<span class="op">.</span><span class="fu">ImageCollection</span>(<span class="st">'MODIS/061/MOD11A1'</span>)</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">select</span>(<span class="st">'LST_Day_1km'</span>)</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">filterDate</span>(startDate<span class="op">,</span> endDate)</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">filterBounds</span>(virginia)<span class="op">;</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a><span class="co">// Define spatial scales</span></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> modisScale <span class="op">=</span> <span class="dv">1000</span><span class="op">;</span>  <span class="co">// MODIS resolution</span></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> fineScale <span class="op">=</span> <span class="dv">100</span><span class="op">;</span>    <span class="co">// High-resolution mask scale</span></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a><span class="co">// Create high-resolution binary mask of Virginia</span></span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> highResMask <span class="op">=</span> ee<span class="op">.</span><span class="at">Image</span><span class="op">.</span><span class="fu">constant</span>(<span class="dv">1</span>)</span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">clip</span>(virginia)</span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">reproject</span>({</span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>    <span class="dt">crs</span><span class="op">:</span> <span class="st">'EPSG:4326'</span><span class="op">,</span></span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>    <span class="dt">scale</span><span class="op">:</span> fineScale</span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a><span class="co">// Compute fractional overlap at MODIS scale</span></span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> fracMask <span class="op">=</span> highResMask</span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">reduceResolution</span>({</span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a>    <span class="dt">reducer</span><span class="op">:</span> ee<span class="op">.</span><span class="at">Reducer</span><span class="op">.</span><span class="fu">mean</span>()<span class="op">,</span></span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a>    <span class="dt">maxPixels</span><span class="op">:</span> <span class="dv">1024</span></span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">reproject</span>({</span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a>    <span class="dt">crs</span><span class="op">:</span> <span class="st">'EPSG:4326'</span><span class="op">,</span></span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a>    <span class="dt">scale</span><span class="op">:</span> modisScale</span>
<span id="cb9-37"><a href="#cb9-37" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb9-38"><a href="#cb9-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-39"><a href="#cb9-39" aria-hidden="true" tabindex="-1"></a><span class="co">// Apply &gt;= 50% inclusion threshold</span></span>
<span id="cb9-40"><a href="#cb9-40" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> binaryMask <span class="op">=</span> fracMask<span class="op">.</span><span class="fu">gte</span>(<span class="fl">0.5</span>)<span class="op">;</span>  <span class="co">// 1 where &gt;=50% of the pixel is inside the boundary; 0 elsewhere</span></span>
<span id="cb9-41"><a href="#cb9-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-42"><a href="#cb9-42" aria-hidden="true" tabindex="-1"></a><span class="co">// Determine weekly intervals</span></span>
<span id="cb9-43"><a href="#cb9-43" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> nWeeks <span class="op">=</span> ee<span class="op">.</span><span class="fu">Number</span>(endDate<span class="op">.</span><span class="fu">difference</span>(startDate<span class="op">,</span> <span class="st">'week'</span>))<span class="op">.</span><span class="fu">ceil</span>()<span class="op">;</span></span>
<span id="cb9-44"><a href="#cb9-44" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> weekList <span class="op">=</span> ee<span class="op">.</span><span class="at">List</span><span class="op">.</span><span class="fu">sequence</span>(<span class="dv">0</span><span class="op">,</span> nWeeks<span class="op">.</span><span class="fu">subtract</span>(<span class="dv">1</span>))<span class="op">;</span></span>
<span id="cb9-45"><a href="#cb9-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-46"><a href="#cb9-46" aria-hidden="true" tabindex="-1"></a><span class="co">// Loop over weeks and compute masked mean LST</span></span>
<span id="cb9-47"><a href="#cb9-47" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> weeklyStats <span class="op">=</span> ee<span class="op">.</span><span class="fu">FeatureCollection</span>(</span>
<span id="cb9-48"><a href="#cb9-48" aria-hidden="true" tabindex="-1"></a>  weekList<span class="op">.</span><span class="fu">map</span>(<span class="kw">function</span>(i) {</span>
<span id="cb9-49"><a href="#cb9-49" aria-hidden="true" tabindex="-1"></a>    i <span class="op">=</span> ee<span class="op">.</span><span class="fu">Number</span>(i)<span class="op">;</span></span>
<span id="cb9-50"><a href="#cb9-50" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> wkStart <span class="op">=</span> startDate<span class="op">.</span><span class="fu">advance</span>(i<span class="op">,</span> <span class="st">'week'</span>)<span class="op">;</span></span>
<span id="cb9-51"><a href="#cb9-51" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> wkEnd <span class="op">=</span> wkStart<span class="op">.</span><span class="fu">advance</span>(<span class="dv">1</span><span class="op">,</span> <span class="st">'week'</span>)<span class="op">;</span></span>
<span id="cb9-52"><a href="#cb9-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-53"><a href="#cb9-53" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Compute weekly average LST image in Celsius</span></span>
<span id="cb9-54"><a href="#cb9-54" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> wkMeanImage <span class="op">=</span> modis</span>
<span id="cb9-55"><a href="#cb9-55" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">filterDate</span>(wkStart<span class="op">,</span> wkEnd)</span>
<span id="cb9-56"><a href="#cb9-56" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">mean</span>()</span>
<span id="cb9-57"><a href="#cb9-57" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">multiply</span>(<span class="fl">0.02</span>)</span>
<span id="cb9-58"><a href="#cb9-58" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">subtract</span>(<span class="fl">273.15</span>)</span>
<span id="cb9-59"><a href="#cb9-59" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">rename</span>(<span class="st">'LST_mean_C'</span>)<span class="op">;</span></span>
<span id="cb9-60"><a href="#cb9-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-61"><a href="#cb9-61" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Apply binary mask using updateMask (removes pixels outside inclusion zone)</span></span>
<span id="cb9-62"><a href="#cb9-62" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> maskedLST <span class="op">=</span> wkMeanImage<span class="op">.</span><span class="fu">updateMask</span>(binaryMask)<span class="op">;</span></span>
<span id="cb9-63"><a href="#cb9-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-64"><a href="#cb9-64" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Compute mean LST only for included pixels</span></span>
<span id="cb9-65"><a href="#cb9-65" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> meanLST <span class="op">=</span> maskedLST<span class="op">.</span><span class="fu">reduceRegion</span>({</span>
<span id="cb9-66"><a href="#cb9-66" aria-hidden="true" tabindex="-1"></a>      <span class="dt">reducer</span><span class="op">:</span> ee<span class="op">.</span><span class="at">Reducer</span><span class="op">.</span><span class="fu">mean</span>()<span class="op">,</span></span>
<span id="cb9-67"><a href="#cb9-67" aria-hidden="true" tabindex="-1"></a>      <span class="dt">geometry</span><span class="op">:</span> virginia<span class="op">,</span></span>
<span id="cb9-68"><a href="#cb9-68" aria-hidden="true" tabindex="-1"></a>      <span class="dt">scale</span><span class="op">:</span> modisScale<span class="op">,</span></span>
<span id="cb9-69"><a href="#cb9-69" aria-hidden="true" tabindex="-1"></a>      <span class="dt">maxPixels</span><span class="op">:</span> <span class="fl">1e13</span></span>
<span id="cb9-70"><a href="#cb9-70" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb9-71"><a href="#cb9-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-72"><a href="#cb9-72" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> ee<span class="op">.</span><span class="fu">Feature</span>(<span class="kw">null</span><span class="op">,</span> {</span>
<span id="cb9-73"><a href="#cb9-73" aria-hidden="true" tabindex="-1"></a>      <span class="st">'week_start'</span><span class="op">:</span> wkStart<span class="op">.</span><span class="fu">format</span>(<span class="st">'YYYY-MM-dd'</span>)<span class="op">,</span></span>
<span id="cb9-74"><a href="#cb9-74" aria-hidden="true" tabindex="-1"></a>      <span class="st">'week_end'</span><span class="op">:</span> wkEnd<span class="op">.</span><span class="fu">format</span>(<span class="st">'YYYY-MM-dd'</span>)<span class="op">,</span></span>
<span id="cb9-75"><a href="#cb9-75" aria-hidden="true" tabindex="-1"></a>      <span class="st">'LST_mean_C'</span><span class="op">:</span> meanLST<span class="op">.</span><span class="fu">get</span>(<span class="st">'LST_mean_C'</span>)</span>
<span id="cb9-76"><a href="#cb9-76" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb9-77"><a href="#cb9-77" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb9-78"><a href="#cb9-78" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span>
<span id="cb9-79"><a href="#cb9-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-80"><a href="#cb9-80" aria-hidden="true" tabindex="-1"></a><span class="co">// Print results</span></span>
<span id="cb9-81"><a href="#cb9-81" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">'Weekly weighted mean LST (°C) for Virginia, Jan–Mar 2024'</span><span class="op">,</span> weeklyStats)<span class="op">;</span></span>
<span id="cb9-82"><a href="#cb9-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-83"><a href="#cb9-83" aria-hidden="true" tabindex="-1"></a><span class="co">// Export to Drive</span></span>
<span id="cb9-84"><a href="#cb9-84" aria-hidden="true" tabindex="-1"></a>Export<span class="op">.</span><span class="at">table</span><span class="op">.</span><span class="fu">toDrive</span>({</span>
<span id="cb9-85"><a href="#cb9-85" aria-hidden="true" tabindex="-1"></a>  <span class="dt">collection</span><span class="op">:</span> weeklyStats<span class="op">,</span></span>
<span id="cb9-86"><a href="#cb9-86" aria-hidden="true" tabindex="-1"></a>  <span class="dt">description</span><span class="op">:</span> <span class="st">'Virginia_Weekly_LST_Thresholded'</span><span class="op">,</span></span>
<span id="cb9-87"><a href="#cb9-87" aria-hidden="true" tabindex="-1"></a>  <span class="dt">fileNamePrefix</span><span class="op">:</span> <span class="st">'Virginia_Weekly_LST_50pctMask_JanMar2024'</span><span class="op">,</span></span>
<span id="cb9-88"><a href="#cb9-88" aria-hidden="true" tabindex="-1"></a>  <span class="dt">fileFormat</span><span class="op">:</span> <span class="st">'CSV'</span></span>
<span id="cb9-89"><a href="#cb9-89" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
</section>
<section id="arrays" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="arrays">2.4 Arrays</h2>
<p>Arrays are structured collections of data elements stored in a defined order, often in contiguous memory. A one-dimensional array is a simple list of values, while multi-dimensional arrays organize data in grids or higher-order structures. A two-dimensional array is commonly known as a matrix, consisting of rows and columns. While terminology may vary across disciplines, understanding arrays is key to working with data structures in GEE.</p>
<p>Google Earth Engine is not optimized for general array-based math, and using arrays outside of its built-in functions can lead to poor performance. While there’s a helpful <a href="https://developers.google.com/earth-engine/guides/arrays_intro">video</a> on the engineering behind GEE, this workshop will only cover basic array transformations, such as aggregation and filtering. For complex array operations, it’s often better to export the data and use a specialized framework.</p>
</section>
<section id="methods-reducers-and-joins" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="methods-reducers-and-joins">2.5 Methods: Reducers and Joins</h2>
<section id="reducers" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="reducers">Reducers</h3>
<p>So far, we’ve worked with objects like Images, Features, and Geometries. Reducers are a method of aggregating data for analysis. For instance, we could take an Image Collection and use <code>reducer</code> to find the average value at each pixel, resulting in a single layer. Or we could reduce an image to a set of regions, grouping similar data together to create a simplified map. Reducers can be applied to both Images and Features, with specific functions for each. They can also be combined to create analysis chains.</p>
<p>In the example below, the variable <code>collection</code> filters imagery for the year 2022 over a point in Blacksburg. The variable <code>maxLST</code> then uses a reducer to extract the maximum land surface temperature in Kelvin for that location.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode javascript code-with-copy"><code class="sourceCode javascript"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Load and filter the MODIS image collection.</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> collection <span class="op">=</span> ee<span class="op">.</span><span class="fu">ImageCollection</span>(<span class="st">'MODIS/006/MOD11A2'</span>)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">select</span>(<span class="st">'LST_Day_1km'</span>)</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">filterDate</span>(<span class="st">'2022-01-01'</span><span class="op">,</span> <span class="st">'2022-12-31'</span>)<span class="op">;</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> scaleAndMaskLST <span class="op">=</span> <span class="kw">function</span>(image) {</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> scaledLST <span class="op">=</span> image<span class="op">.</span><span class="fu">multiply</span>(<span class="fl">0.02</span>)<span class="op">;</span> <span class="co">// MODIS LST values are stored as scaled integers; multiply them by 0.02 to convert to Kelvin.</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> maskedLST <span class="op">=</span> scaledLST<span class="op">.</span><span class="fu">updateMask</span>(</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    image<span class="op">.</span><span class="fu">neq</span>(<span class="dv">0</span>)<span class="op">.</span><span class="fu">and</span>(image<span class="op">.</span><span class="fu">gte</span>(<span class="dv">7500</span>))<span class="op">.</span><span class="fu">and</span>(image<span class="op">.</span><span class="fu">lte</span>(<span class="dv">65535</span>)) <span class="co">// Exclude pixels with a value of 0, keep only pixels with scaled LST greater than 7500, and exclude values outside the valid MODIS range.</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span> </span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> maskedLST<span class="op">;</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> processedCollection <span class="op">=</span> collection<span class="op">.</span><span class="fu">map</span>(scaleAndMaskLST)<span class="op">;</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a><span class="co">// Define a point for Blacksburg, VA (using coordinates from search results)</span></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> blacksburg <span class="op">=</span> ee<span class="op">.</span><span class="at">Geometry</span><span class="op">.</span><span class="fu">Point</span>(<span class="op">-</span><span class="fl">80.4139</span><span class="op">,</span> <span class="fl">37.2296</span>)<span class="op">;</span></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a><span class="co">// Reduce the collection to a single image representing the maximum LST</span></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> maxLSTImage <span class="op">=</span> processedCollection<span class="op">.</span><span class="fu">reduce</span>(ee<span class="op">.</span><span class="at">Reducer</span><span class="op">.</span><span class="fu">max</span>())<span class="op">;</span></span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a><span class="co">// Get the maximum LST value at the Blacksburg point</span></span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> maxLSTKelvin <span class="op">=</span> maxLSTImage<span class="op">.</span><span class="fu">reduceRegion</span>({</span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>  <span class="dt">reducer</span><span class="op">:</span> ee<span class="op">.</span><span class="at">Reducer</span><span class="op">.</span><span class="fu">max</span>()<span class="op">,</span></span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>  <span class="dt">geometry</span><span class="op">:</span> blacksburg<span class="op">,</span></span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a>  <span class="dt">scale</span><span class="op">:</span> <span class="dv">1000</span> <span class="co">// Use the MODIS resolution (1km)</span></span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a>})<span class="op">.</span><span class="fu">get</span>(<span class="st">'LST_Day_1km_max'</span>)<span class="op">;</span></span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a><span class="co">// Convert Kelvin to Fahrenheit: F = (K - 273.15) * 9/5 + 32</span></span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> maxLSTFahrenheit <span class="op">=</span> ee<span class="op">.</span><span class="fu">Number</span>(maxLSTKelvin)</span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">subtract</span>(<span class="fl">273.15</span>)</span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">multiply</span>(<span class="dv">9</span>)</span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">divide</span>(<span class="dv">5</span>)</span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">add</span>(<span class="dv">32</span>)<span class="op">;</span></span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a><span class="co">// Print the results</span></span>
<span id="cb10-37"><a href="#cb10-37" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">'Maximum LST in Blacksburg (Kelvin):'</span><span class="op">,</span> maxLSTKelvin)<span class="op">;</span></span>
<span id="cb10-38"><a href="#cb10-38" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">'Maximum LST in Blacksburg (Fahrenheit):'</span><span class="op">,</span> maxLSTFahrenheit)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>There are hundreds of different operations for using <code>Reducer</code>, with the functions listed in the <strong>‘Docs’ tab</strong>. Certain functions will only work with specific object types, but follow along with the <a href="https://developers.google.com/earth-engine/guides/reducers_intro">Reducer</a> will help you understand how to aggregate data and extract useful results. Getting familiar with Reducer is an essential component to working with GEE.</p>
</section>
<section id="join" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="join">Join</h3>
<p>This process links information from one dataset to another based on a shared attribute. For example, you can join a Landsat ImageCollection from early 2016 with a FeatureCollection of agriculture locations from the past decade, filtered to the same area. The Join keeps only relevant data, combining useful information from both sources. While there are different types of joins, the key idea is merging data meaningfully.</p>
<p>Although there are different types of joins, the process brings information together, keeping only relevant information. The <a href="https://developers.google.com/earth-engine/guides/joins_save_all">documentation</a> on Joins goes over specific examples and concepts, and it’s important to understand which type of join best fits your analysis. The three most common join types in GEE are:</p>
<ul>
<li><strong>Left Join</strong>: Retains all records from the primary dataset and adds matching information from the secondary dataset when available.</li>
<li><strong>Inner Join</strong>: Keeps only the records where both the primary and secondary datasets have a matching entry.</li>
<li><strong>Spatial Join</strong>: Combines datasets based on geographic location (ie, keeping only the features from one dataset that fall within a specified buffer)</li>
</ul>
</section>
</section>
</section>
<section id="physical-bases-of-remote-sensing" class="level1 unnumbered">
<h1 class="unnumbered">3. Physical Bases of Remote Sensing</h1>
<section id="four-types-of-resolution" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="four-types-of-resolution">Four Types of Resolution</h2>
<ul>
<li>Spatial resolution: The size of the smallest object that can be detected (i.e., pixel size). <img src="figures/Spatial.png" class="img-fluid" alt="Spatial resolutions"></li>
<li>Temporal resolution: The frequency at which a sensor revisits the same location on Earth (i.e., revisit time or orbital period).</li>
<li>Spectral resolution: The ability of a sensor to distinguish between different wavelengths (i.e., number and width of spectral bands). <img src="figures/Spectral.png" class="img-fluid" alt="Wavelength vs Reflectance"></li>
<li>Radiometric resolution: The sensor’s sensitivity to differences in signal intensity or reflectance (i.e., bit depth). <img src="figures/Radiometric.png" class="img-fluid" alt="Radiometric Resolution"></li>
</ul>
<p>Suppose we are working with Landsat 8 and want to find key details such as the image scale, the number of images within a specific time range, the number of bands, and the data type of each band (across four resolutions). We can either look up this information in the documentation or use the following code to extract it directly.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode javascript code-with-copy"><code class="sourceCode javascript"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Load a Landsat 8 image collection.</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> collection <span class="op">=</span> ee<span class="op">.</span><span class="fu">ImageCollection</span>(<span class="st">'LANDSAT/LC08/C02/T1_L2'</span>)<span class="op">;</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="co">// It's a good practice to filter by date or location for a specific image.</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> image <span class="op">=</span> collection<span class="op">.</span><span class="fu">first</span>()<span class="op">;</span> </span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="co">// Here, I manually select the first image in the collection based on the internal ordering, </span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="co">// which is typically the earliest image from the satellite (chronological).</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a><span class="co">// --- Spatial Resolution ---</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a><span class="co">// The nominal scale (in meters) of the image's default projection.</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a><span class="co">// For Landsat 8, most bands are 30 meters, the panchromatic band is 15 meters.</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> spatialResolution <span class="op">=</span> image<span class="op">.</span><span class="fu">projection</span>()<span class="op">.</span><span class="fu">nominalScale</span>()<span class="op">;</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">'Spatial Resolution (nominal scale in meters):'</span><span class="op">,</span> spatialResolution)<span class="op">;</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a><span class="co">// You can also get the resolution of specific bands.</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a><span class="co">// For example, band B4 (Red)</span></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> bandB4 <span class="op">=</span> image<span class="op">.</span><span class="fu">select</span>(<span class="st">'SR_B4'</span>)<span class="op">;</span></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> spatialResolutionB4 <span class="op">=</span> bandB4<span class="op">.</span><span class="fu">projection</span>()<span class="op">.</span><span class="fu">nominalScale</span>()<span class="op">;</span></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">'Spatial Resolution for SR_B4 (Red band) in meters:'</span><span class="op">,</span> spatialResolutionB4)<span class="op">;</span></span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a><span class="co">// --- Temporal Resolution ---</span></span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a><span class="co">// Landsat 8 has a nominal temporal resolution (revisit period) of 16 days.</span></span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a><span class="co">// This is a characteristic of the satellite's orbit, not a property directly</span></span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a><span class="co">// extractable from a single image object in GEE.</span></span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a><span class="co">// However, you utilize this resolution when filtering image collections by date.</span></span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> temporalResolutionComment <span class="op">=</span> <span class="st">'Temporal Resolution: Landsat 8 has a nominal revisit period of 16 days.'</span><span class="op">;</span></span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(temporalResolutionComment)<span class="op">;</span></span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a><span class="co">// Example of how to use temporal resolution:</span></span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a><span class="co">// Filtering the collection to see how many images are available within a 30-day window</span></span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> startDate <span class="op">=</span> ee<span class="op">.</span><span class="fu">Date</span>(<span class="st">'2023-01-01'</span>)<span class="op">;</span></span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> endDate <span class="op">=</span> startDate<span class="op">.</span><span class="fu">advance</span>(<span class="dv">30</span><span class="op">,</span> <span class="st">'day'</span>)<span class="op">;</span></span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> imagesIn30Days <span class="op">=</span> collection<span class="op">.</span><span class="fu">filterDate</span>(startDate<span class="op">,</span> endDate)<span class="op">;</span></span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">'Number of images available in a 30-day window (illustrates temporal sampling):'</span><span class="op">,</span> imagesIn30Days<span class="op">.</span><span class="fu">size</span>())<span class="op">;</span></span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true" tabindex="-1"></a><span class="co">// --- Spectral Resolution ---</span></span>
<span id="cb11-37"><a href="#cb11-37" aria-hidden="true" tabindex="-1"></a><span class="co">// This refers to the number and width of the spectral bands.</span></span>
<span id="cb11-38"><a href="#cb11-38" aria-hidden="true" tabindex="-1"></a><span class="co">// We can list the band names.</span></span>
<span id="cb11-39"><a href="#cb11-39" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> bandNames <span class="op">=</span> image<span class="op">.</span><span class="fu">bandNames</span>()<span class="op">;</span></span>
<span id="cb11-40"><a href="#cb11-40" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">'Spectral Bands (Names):'</span><span class="op">,</span> bandNames)<span class="op">;</span></span>
<span id="cb11-41"><a href="#cb11-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-42"><a href="#cb11-42" aria-hidden="true" tabindex="-1"></a><span class="co">// To get more detailed spectral information (e.g., wavelength ranges, data types),</span></span>
<span id="cb11-43"><a href="#cb11-43" aria-hidden="true" tabindex="-1"></a><span class="co">// inspect the 'bandTypes()' object. This object contains properties for each band,</span></span>
<span id="cb11-44"><a href="#cb11-44" aria-hidden="true" tabindex="-1"></a><span class="co">// which may include 'wavelength_min', 'wavelength_max', 'data_type', etc.,</span></span>
<span id="cb11-45"><a href="#cb11-45" aria-hidden="true" tabindex="-1"></a><span class="co">// if they are part of the dataset's metadata in GEE.</span></span>
<span id="cb11-46"><a href="#cb11-46" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">'All image band properties (inspect this object for spectral details):'</span><span class="op">,</span> image<span class="op">.</span><span class="fu">bandTypes</span>())<span class="op">;</span></span>
<span id="cb11-47"><a href="#cb11-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-48"><a href="#cb11-48" aria-hidden="true" tabindex="-1"></a><span class="co">// --- Radiometric Resolution ---</span></span>
<span id="cb11-49"><a href="#cb11-49" aria-hidden="true" tabindex="-1"></a><span class="co">// This is typically indicated by the data type (e.g., int8, int16, float32).</span></span>
<span id="cb11-50"><a href="#cb11-50" aria-hidden="true" tabindex="-1"></a><span class="co">// 'int16' means 16-bit radiometric resolution.</span></span>
<span id="cb11-51"><a href="#cb11-51" aria-hidden="true" tabindex="-1"></a><span class="co">// Access the data_type property from the bandTypes() dictionary for SR_B4.</span></span>
<span id="cb11-52"><a href="#cb11-52" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> bandTypesDict <span class="op">=</span> image<span class="op">.</span><span class="fu">bandTypes</span>()<span class="op">;</span></span>
<span id="cb11-53"><a href="#cb11-53" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> srb4Type <span class="op">=</span> bandTypesDict<span class="op">.</span><span class="fu">get</span>(<span class="st">'SR_B4'</span>)<span class="op">;</span></span>
<span id="cb11-54"><a href="#cb11-54" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">'Radiometric Resolution (Data Type for SR_B4):'</span><span class="op">,</span> srb4Type)<span class="op">;</span></span>
<span id="cb11-55"><a href="#cb11-55" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">'Image Data Type (dictionary of all band types):'</span><span class="op">,</span> bandTypesDict)<span class="op">;</span></span>
<span id="cb11-56"><a href="#cb11-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-57"><a href="#cb11-57" aria-hidden="true" tabindex="-1"></a><span class="co">// You can also check the data type of the entire image (which is a dictionary of all band types)</span></span>
<span id="cb11-58"><a href="#cb11-58" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">'Image Data Type (overall, as a dictionary of band types):'</span><span class="op">,</span> image<span class="op">.</span><span class="fu">bandTypes</span>())<span class="op">;</span></span>
<span id="cb11-59"><a href="#cb11-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-60"><a href="#cb11-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-61"><a href="#cb11-61" aria-hidden="true" tabindex="-1"></a><span class="co">// Add the image to the map for visual inspection</span></span>
<span id="cb11-62"><a href="#cb11-62" aria-hidden="true" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">centerObject</span>(image<span class="op">,</span> <span class="dv">10</span>)<span class="op">;</span></span>
<span id="cb11-63"><a href="#cb11-63" aria-hidden="true" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(image<span class="op">,</span> {<span class="dt">bands</span><span class="op">:</span> [<span class="st">'SR_B4'</span><span class="op">,</span> <span class="st">'SR_B3'</span><span class="op">,</span> <span class="st">'SR_B2'</span>]<span class="op">,</span> <span class="dt">min</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> <span class="dt">max</span><span class="op">:</span> <span class="dv">20000</span>}<span class="op">,</span> <span class="st">'Landsat 8 True Color'</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Each pixel has a <a href="https://en.wikipedia.org/wiki/Geographic_coordinate_system">geographic coordinate system</a>, defined relative to the axes of a coordinate reference system (CRS). In Earth Engine, the CRS is often referred to as a <a href="https://en.wikipedia.org/wiki/Map_projection">projection</a> because it includes the model of the Earth’s shape (<a href="https://en.wikipedia.org/wiki/Geodetic_datum">datum</a>) and the mathematical transformation that maps a 3D shape onto a 2D surface. This projection determines how spatial data is represented on a flat map.</p>
</section>
</section>
<section id="time-series-plots" class="level1 unnumbered">
<h1 class="unnumbered">4. Time Series Plots</h1>
<section id="data-preparation" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="data-preparation">Data Preparation</h3>
<p>The first step in analyzing time series data is to import the dataset of interest and plot it for a specific location. In this case, the region of interest is the NDVI in Blacksburg, VA.</p>
<p>We begin by loading the Landsat 8 collection and defining a point at the region of interest. Additionally, we will create a time field to support the time series analysis.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode javascript code-with-copy"><code class="sourceCode javascript"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Define the Landsat 8 Collection 2, Tier 1, Level 2 Surface Reflectance.</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> landsat8Sr <span class="op">=</span> ee<span class="op">.</span><span class="fu">ImageCollection</span>(<span class="st">"LANDSAT/LC08/C02/T1_L2"</span>)<span class="op">;</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="co">// Define the Region of Interest (ROI).</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> roi <span class="op">=</span> ee<span class="op">.</span><span class="at">Geometry</span><span class="op">.</span><span class="fu">Point</span>([<span class="op">-</span><span class="fl">80.4139</span><span class="op">,</span> <span class="fl">37.2296</span>])<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The function <code>maskL8srClouds</code> is a cloud-masking function that uses the Quality Assurance (QA) band of Landsat 8 to mask out pixels obscured by clouds. Note that this function is specific to Landsat 8; using other platforms will require a different approach.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode javascript code-with-copy"><code class="sourceCode javascript"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Function to cloud mask from the QA_PIXEL band of Landsat 8 SR data.</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">maskL8srClouds</span>(image) {</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Get the QA_PIXEL band.</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> qa <span class="op">=</span> image<span class="op">.</span><span class="fu">select</span>(<span class="st">'QA_PIXEL'</span>)<span class="op">;</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Bits 3 and 4 are cloud and cloud shadow respectively.</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> cloudBitMask <span class="op">=</span> <span class="dv">1</span> <span class="op">&lt;&lt;</span> <span class="dv">3</span><span class="op">;</span>    <span class="co">// Bit 3: cloud</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> cloudShadowBitMask <span class="op">=</span> <span class="dv">1</span> <span class="op">&lt;&lt;</span> <span class="dv">4</span><span class="op">;</span> <span class="co">// Bit 4: cloud shadow</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Both flags should be off to indicate clear conditions.</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> mask <span class="op">=</span> qa<span class="op">.</span><span class="fu">bitwiseAnd</span>(cloudBitMask)<span class="op">.</span><span class="fu">eq</span>(<span class="dv">0</span>)</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>                 <span class="op">.</span><span class="fu">and</span>(qa<span class="op">.</span><span class="fu">bitwiseAnd</span>(cloudShadowBitMask)<span class="op">.</span><span class="fu">eq</span>(<span class="dv">0</span>))<span class="op">;</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Apply the mask and scale reflectance bands.</span></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Select only the desired surface reflectance bands and then apply scaling.</span></span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> image<span class="op">.</span><span class="fu">updateMask</span>(mask)</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>              <span class="op">.</span><span class="fu">select</span>([<span class="st">'SR_B2'</span><span class="op">,</span> <span class="st">'SR_B3'</span><span class="op">,</span> <span class="st">'SR_B4'</span><span class="op">,</span> <span class="st">'SR_B5'</span><span class="op">,</span> <span class="st">'SR_B6'</span><span class="op">,</span> <span class="st">'SR_B7'</span>]) <span class="co">// Surface reflectance bands</span></span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>              <span class="op">.</span><span class="fu">multiply</span>(<span class="fl">0.0000275</span>)    <span class="co">// Apply scale factor</span></span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>              <span class="op">.</span><span class="fu">add</span>(<span class="op">-</span><span class="fl">0.2</span>)             <span class="co">// Apply offset</span></span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>              <span class="op">.</span><span class="fu">copyProperties</span>(image<span class="op">,</span> [<span class="st">'system:time_start'</span><span class="op">,</span> <span class="st">'system:index'</span>])<span class="op">;</span> <span class="co">// Also copy system:index for better identification if needed</span></span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="vegetation-index" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="vegetation-index">Vegetation Index</h3>
<p>We can use one of several indices to measure vegetation health, with the <strong>Normalized Difference Vegetation Index (NDVI)</strong> being one of the most widely used. NDVI is a well-known metric for quantifying vegetation vigor. For this region of interest, we expect strong seasonality and possibly a gradual linear trend over time. NDVI values range from -1 to 1. Higher values (typically <strong>0.2 to 0.8</strong>) indicate healthy, green vegetation, while values near 0 or negative indicate barren land, water, clouds, or non-vegetated surfaces. <span class="math display">\[NDVI = \frac{NIR - Red}{NIR + Red}\]</span></p>
<p>In the code block below, we create a function called <code>addVariables</code> that extracts the date of each image, calculates NDVI and adds it to an array. We can then use <code>.map()</code> to apply the two functions across the image collection, enabling us to build a time series model of our data.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode javascript code-with-copy"><code class="sourceCode javascript"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Use function to add variables for NDVI, time and a constant to Landsat 8 imagery.</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">addVariables</span>(image) {</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> ndvi <span class="op">=</span> image<span class="op">.</span><span class="fu">normalizedDifference</span>([<span class="st">'SR_B5'</span><span class="op">,</span> <span class="st">'SR_B4'</span>])<span class="op">.</span><span class="fu">rename</span>(<span class="st">'NDVI'</span>)<span class="op">;</span> <span class="co">// Compute NDVI.</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> time <span class="op">=</span> ee<span class="op">.</span><span class="at">Image</span><span class="op">.</span><span class="fu">constant</span>(</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>    image<span class="op">.</span><span class="fu">date</span>()<span class="op">.</span><span class="fu">difference</span>(ee<span class="op">.</span><span class="fu">Date</span>(<span class="st">'1970-01-01'</span>)<span class="op">,</span> <span class="st">'year'</span>)</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>  )<span class="op">.</span><span class="fu">rename</span>(<span class="st">'time'</span>)<span class="op">;</span> <span class="co">// Compute fractional year since 1970 and convert to image.</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> constant <span class="op">=</span> ee<span class="op">.</span><span class="fu">Image</span>(<span class="dv">1</span>)<span class="op">.</span><span class="fu">rename</span>(<span class="st">'constant'</span>)<span class="op">;</span> <span class="co">// Constant band.</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> image<span class="op">.</span><span class="fu">addBands</span>([ndvi<span class="op">,</span> time<span class="op">,</span> constant])<span class="op">;</span> <span class="co">// Add all variables.</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a><span class="co">// Remove clouds, add variables and filter to the roi.</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> processedLandsat <span class="op">=</span> landsat8Sr</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">filterBounds</span>(roi)</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">map</span>(maskL8srClouds)</span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">map</span>(addVariables)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="agriculture-phenology" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="agriculture-phenology">Agriculture Phenology</h3>
<p>Phenology is the study of the relationship between vegetative growth and environmental conditions, often focusing on seasonal patterns of growth and decline. For instance, the <a href="https://www.almanac.com/gardening/planting-calendar/VA/Blacksburg%2C%20Montgomery%20County">crop calendar in Blacksburg, VA</a> can serve as a useful reference for expected planting and harvest times. By plotting NDVI over the time period of interest, we can compare observed vegetation changes with the growing season to assess crop conditions.</p>
<p>Aerial imagery enhances agricultural analysis by providing high-resolution insights into crop conditions and land use patterns, especially when combined with local agricultural knowledge. For example, a farmer can use <strong>Landsat 8</strong> imagery to calculate NDVI every 5 days during the growing season, helping to detect early signs of crop stress or disease. <strong>MODIS</strong> imagery can be used to monitor broader climate conditions, such as droughts. Additionally, the <strong>Dynamic World</strong> dataset can help track changes in agricultural land cover over time.</p>
</section>
<section id="data-visualization" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="data-visualization">Data Visualization</h3>
<p>To visualize the data, we will export a chart at the location of interest. We will add a linear trend line for reference.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode javascript code-with-copy"><code class="sourceCode javascript"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Plot a time series of NDVI at a single location.</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> l8Chart <span class="op">=</span> ui<span class="op">.</span><span class="at">Chart</span><span class="op">.</span><span class="at">image</span><span class="op">.</span><span class="fu">series</span>({</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">imageCollection</span><span class="op">:</span> processedLandsat<span class="op">.</span><span class="fu">select</span>(<span class="st">'NDVI'</span>)<span class="op">,</span> <span class="co">// Select the 'NDVI' band for charting</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">region</span><span class="op">:</span> roi<span class="op">,</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">reducer</span><span class="op">:</span> ee<span class="op">.</span><span class="at">Reducer</span><span class="op">.</span><span class="fu">mean</span>()<span class="op">,</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>  <span class="dt">scale</span><span class="op">:</span> <span class="dv">30</span><span class="op">,</span> <span class="co">// Landsat 8 resolution</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>  <span class="dt">xProperty</span><span class="op">:</span> <span class="st">'system:time_start'</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="op">.</span><span class="fu">setChartType</span>(<span class="st">'ScatterChart'</span>)</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a><span class="op">.</span><span class="fu">setOptions</span>({</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>  <span class="dt">title</span><span class="op">:</span> <span class="st">'Landsat 8 NDVI Time Series at ROI'</span><span class="op">,</span></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>  <span class="dt">hAxis</span><span class="op">:</span> {<span class="dt">title</span><span class="op">:</span> <span class="st">'Date'</span>}<span class="op">,</span></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>  <span class="dt">vAxis</span><span class="op">:</span> {<span class="dt">title</span><span class="op">:</span> <span class="st">'NDVI'</span>}<span class="op">,</span></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>  <span class="dt">trendlines</span><span class="op">:</span> {<span class="dv">0</span><span class="op">:</span> {<span class="dt">color</span><span class="op">:</span> <span class="st">'CC0000'</span>}}<span class="op">,</span> <span class="co">// Add a trendline for the NDVI</span></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>  <span class="dt">lineWidth</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>  <span class="dt">pointSize</span><span class="op">:</span> <span class="dv">3</span><span class="op">,</span></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Ensure the chart is not too large and is placed appropriately</span></span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>  <span class="dt">height</span><span class="op">:</span> <span class="dv">300</span><span class="op">,</span></span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>  <span class="dt">width</span><span class="op">:</span> <span class="dv">700</span></span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a><span class="co">// Display the chart in the console.</span></span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(l8Chart)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="export-data-as-a-csv-file-to-google-drive" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="export-data-as-a-csv-file-to-google-drive">Export Data as a CSV File to Google Drive</h3>
<p>The code will export the NDVI time series to Google Drive. You can check the <strong>“Tasks” tab</strong> (on the right panel) and <strong>click “Run”</strong> to start the export.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode javascript code-with-copy"><code class="sourceCode javascript"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Create a FeatureCollection where each feature represents a date and its NDVI value.</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> timeSeriesFeatures <span class="op">=</span> processedLandsat<span class="op">.</span><span class="fu">map</span>(<span class="kw">function</span>(image) {</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> stats <span class="op">=</span> image<span class="op">.</span><span class="fu">reduceRegion</span>({</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">reducer</span><span class="op">:</span> ee<span class="op">.</span><span class="at">Reducer</span><span class="op">.</span><span class="fu">mean</span>()<span class="op">,</span> <span class="co">// Calculate the mean NDVI over the ROI</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">geometry</span><span class="op">:</span> roi<span class="op">,</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">scale</span><span class="op">:</span> <span class="dv">30</span><span class="op">,</span> <span class="co">// Landsat resolution in meters</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">maxPixels</span><span class="op">:</span> <span class="fl">1e9</span> <span class="co">// Allow for a large number of pixels</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> ndviValue <span class="op">=</span> ee<span class="op">.</span><span class="at">Algorithms</span><span class="op">.</span><span class="fu">If</span>(stats<span class="op">.</span><span class="fu">contains</span>(<span class="st">'NDVI'</span>)<span class="op">,</span> stats<span class="op">.</span><span class="fu">get</span>(<span class="st">'NDVI'</span>)<span class="op">,</span> <span class="kw">null</span>)<span class="op">;</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Return a feature with the date and the NDVI value</span></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> ee<span class="op">.</span><span class="fu">Feature</span>(<span class="kw">null</span><span class="op">,</span> {</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">'date'</span><span class="op">:</span> image<span class="op">.</span><span class="fu">date</span>()<span class="op">.</span><span class="fu">format</span>(<span class="st">'YYYY-MM-dd'</span>)<span class="op">,</span></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">'NDVI'</span><span class="op">:</span> ndviValue</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a><span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">notNull</span>([<span class="st">'NDVI'</span>]))<span class="op">;</span></span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a><span class="co">// Export the FeatureCollection to Google Drive as a CSV</span></span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>Export<span class="op">.</span><span class="at">table</span><span class="op">.</span><span class="fu">toDrive</span>({</span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>  <span class="dt">collection</span><span class="op">:</span> timeSeriesFeatures<span class="op">,</span></span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>  <span class="dt">description</span><span class="op">:</span> <span class="st">'NDVI_TimeSeries_ROI_Blacksburg'</span><span class="op">,</span> <span class="co">// Task description</span></span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>  <span class="co">//folder: 'GEE_Exports', // Optional: specify a folder in your Google Drive</span></span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a>  <span class="dt">fileNamePrefix</span><span class="op">:</span> <span class="st">'NDVI_TimeSeries_Blacksburg'</span><span class="op">,</span> <span class="co">// Prefix for the output file name</span></span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a>  <span class="dt">fileFormat</span><span class="op">:</span> <span class="st">'CSV'</span></span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>You can click on the <strong>“Export” button</strong> next to the chart to view an iteractive chart. Scroll over some of the data points and look at the relationships between them. A line connecting two dots indicates sequential data points, and note that there are relatively few of them. The chart shows noticeable jumps in the data, with an upward trend between March and late April, followed by a decline in late August. Although the pattern varies slightly each year, it likely reflects seasonal rains in the spring and leaf senescence in the fall. Overall, the general trend is upward.</p>
</section>
<section id="additional-resources" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="additional-resources">Additional Resources</h2>
<ul>
<li>Google Earth Engine <a href="https://earthengine.google.com">link</a></li>
<li>Code Editor <a href="https://developers.google.com/earth-engine/guides/playground?hl=en">Map</a> – what all the features on the code editor mean</li>
<li>Google Earth Engine <a href="https://medium.com/google-earth">Blog</a></li>
<li><a href="https://www.youtube.com/googleearth">Video</a> tutorials on using GEE (from the Earth Engine Users’ Summit)</li>
</ul>
</section>
</section>
<section id="raster-images-v.s.-vector-images" class="level1 unnumbered">
<h1 class="unnumbered">5. Raster Images v.s. Vector Images</h1>
<section id="brief-summary" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="brief-summary">Brief Summary</h3>
<table class="table">
<colgroup>
<col style="width: 27%">
<col style="width: 36%">
<col style="width: 36%">
</colgroup>
<thead>
<tr class="header">
<th>Factor</th>
<th>Raster</th>
<th>Vector</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Data Type</td>
<td>Continuous</td>
<td>Discrete</td>
</tr>
<tr class="even">
<td>Spatial Resolution</td>
<td>Critical</td>
<td>Less important</td>
</tr>
<tr class="odd">
<td>File Size</td>
<td>Usually large</td>
<td>Smaller</td>
</tr>
<tr class="even">
<td>Processing Complexity</td>
<td>High (especially time-series)</td>
<td>Moderate to high for large datasets</td>
</tr>
<tr class="odd">
<td>Preferred Tools</td>
<td>GEE, GDAL, QGIS, ArcGIS</td>
<td>QGIS, GeoPandas, ArcGIS</td>
</tr>
<tr class="even">
<td>File Format and Metadata</td>
<td><code>.tif</code>, <code>.tiff</code>, <code>.img</code>, <code>.nc</code></td>
<td><code>.shp</code>, <code>.json</code> , GeoPandas</td>
</tr>
</tbody>
</table>
<p><br></p>
<p><strong>Note</strong>: <code>.csv</code>: Needs geocoding to use spatially. Limited spatial metadata.</p>
</section>
<section id="analytical-capability" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="analytical-capability">Analytical Capability</h3>
<table class="table">
<colgroup>
<col style="width: 49%">
<col style="width: 50%">
</colgroup>
<thead>
<tr class="header">
<th>Raster Analysis</th>
<th>Vector Analysis</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Classification (e.g., land cover)</td>
<td>Spatial joins and overlays</td>
</tr>
<tr class="even">
<td>Time-series change detection</td>
<td>Buffer, centroid, and intersection</td>
</tr>
<tr class="odd">
<td>Zonal statistics</td>
<td>Network or routing analysis</td>
</tr>
<tr class="even">
<td>Image differencing, band math</td>
<td>Attribute filtering, labeling</td>
</tr>
</tbody>
</table>
</section>
<section id="practical-examples" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="practical-examples">Practical Examples</h3>
<table class="table">
<colgroup>
<col style="width: 34%">
<col style="width: 21%">
<col style="width: 43%">
</colgroup>
<thead>
<tr class="header">
<th>Scenario</th>
<th>Best Image Type</th>
<th>Reason</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Estimating vegetation health (NDVI)</td>
<td>Raster</td>
<td>Allows pixel-wise index computation</td>
</tr>
<tr class="even">
<td>Mapping children’s health care program</td>
<td>Vector</td>
<td>Discrete boundaries needed</td>
</tr>
<tr class="odd">
<td>Calculating average temperature per county</td>
<td>Raster + Vector</td>
<td>Overlay raster temperature on polygon</td>
</tr>
<tr class="even">
<td>Web-based mapping</td>
<td>Vector</td>
<td>Lightweight and browser-compatible</td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="find-a-suitable-remote-sensing-data" class="level1 unnumbered">
<h1 class="unnumbered">6. Find a Suitable Remote Sensing Data</h1>
<p>To find a suitable satellite (remote sensing) dataset for your project:</p>
<ul>
<li><strong>Variables of intereset</strong>: NDVI, LST, land cover, precipitation, pollutants, urban extent, etc.</li>
<li><strong>Data Quality</strong>: reported noise, cloud issues, or atmospheric interference, published accuracy assessment? Check preprocessing and accessibility in Literature</li>
<li><strong>Spatial resolution</strong>: e.g., household-level ( 10–30m) vs regional (¿250m)</li>
<li><strong>Temporal resolution</strong>: daily, weekly, monthly, or annual?</li>
<li><strong>Time span</strong>: historical baseline, near real-time, or future projections?</li>
<li><strong>Data type</strong>: raster (imagery), vector (features), tabular (summary)</li>
</ul>
</section>
<section id="optional-set-gee-api-through-rstudio" class="level1 unnumbered">
<h1 class="unnumbered">Optional: Set GEE API through RStudio</h1>
<section id="o.1.-set-python-environment-in-terminal" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="o.1.-set-python-environment-in-terminal">O.1. Set Python environment in terminal</h3>
<pre class="termial"><code># Create the virtual environment
python3 -m venv gee-env
# Activate it
source gee-env/bin/activate

# Check if the directory actually exists
ls ~

# Change into home directory’s subfolder called GEE
cd ~/gee-env

# Install GEE API
pip install --upgrade earthengine-api numpy pandas
earthengine authenticate
# Follow the URL it prints, grant access in a browser, then paste the verification code back into terminal. Will show "Successfully saved authorization token."

# Test with
python - &lt;&lt;EOF
import ee
ee.Initialize()
print("GEE initialized:", ee.data.getAssetRoots())
EOF</code></pre>
</section>
<section id="o.2.-connect-rstudio-with-existing-python-environment" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="o.2.-connect-rstudio-with-existing-python-environment">O.2. Connect RStudio with existing python environment</h3>
<div class="sourceCode" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages("remotes")</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>remotes<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">"r-spatial/rgee"</span>)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Set system Python </span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="fu">Sys.setenv</span>(<span class="at">RETICULATE_PYTHON =</span> <span class="st">"~/gee-env/bin/python"</span>)</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Check Python version available to R, make sure R version is 4.3.3 or higher</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages("reticulate") </span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(reticulate)</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a><span class="fu">use_python</span>(<span class="st">"~/gee-env/bin/python"</span>, <span class="at">required =</span> <span class="cn">TRUE</span>)</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a><span class="fu">py_config</span>()</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a><span class="co"># If R has already been initialized a python version, restart R (Session &gt; Restart R) and rerun the code</span></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Verify that GEE API is installed</span></span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a><span class="fu">py_module_available</span>(<span class="st">"ee"</span>) </span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a><span class="co"># If false, go to the terminal and run</span></span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a><span class="co"># source ~/gee-env/bin/activate </span></span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a><span class="co">#  pip install --upgrade earthengine-api numpy pandas six </span></span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a><span class="co"># # Verify the import</span></span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a><span class="co"># python - &lt;&lt;EOF</span></span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a><span class="co"># import ee; print("EE version:", ee.__version__)</span></span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a><span class="co"># import numpy; print("NumPy version:", numpy.__version__) </span></span>
<span id="cb18-27"><a href="#cb18-27" aria-hidden="true" tabindex="-1"></a><span class="co"># import pandas; print("pandas version:", pandas.__version__)</span></span>
<span id="cb18-28"><a href="#cb18-28" aria-hidden="true" tabindex="-1"></a><span class="co"># import six; print("six version:   ", six.__version__) </span></span>
<span id="cb18-29"><a href="#cb18-29" aria-hidden="true" tabindex="-1"></a><span class="co"># EOF</span></span>
<span id="cb18-30"><a href="#cb18-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-31"><a href="#cb18-31" aria-hidden="true" tabindex="-1"></a><span class="co"># # If no error</span></span>
<span id="cb18-32"><a href="#cb18-32" aria-hidden="true" tabindex="-1"></a><span class="co"># deactivate</span></span>
<span id="cb18-33"><a href="#cb18-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-34"><a href="#cb18-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-35"><a href="#cb18-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Load rgee</span></span>
<span id="cb18-36"><a href="#cb18-36" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rgee)</span>
<span id="cb18-37"><a href="#cb18-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-38"><a href="#cb18-38" aria-hidden="true" tabindex="-1"></a><span class="co"># Check that rgee sees earthengine-api (and its Python deps)</span></span>
<span id="cb18-39"><a href="#cb18-39" aria-hidden="true" tabindex="-1"></a><span class="fu">ee_check_python</span>()</span>
<span id="cb18-40"><a href="#cb18-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-41"><a href="#cb18-41" aria-hidden="true" tabindex="-1"></a><span class="co"># If it comes with error, check each package manually</span></span>
<span id="cb18-42"><a href="#cb18-42" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Import Earth Engine</span></span>
<span id="cb18-43"><a href="#cb18-43" aria-hidden="true" tabindex="-1"></a>ee_module <span class="ot">&lt;-</span> <span class="fu">try</span>(<span class="fu">import</span>(<span class="st">"ee"</span>), <span class="at">silent =</span> <span class="cn">TRUE</span>)</span>
<span id="cb18-44"><a href="#cb18-44" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">inherits</span>(ee_module, <span class="st">"try-error"</span>)) {</span>
<span id="cb18-45"><a href="#cb18-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Cannot import earthengine-api (ee).</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb18-46"><a href="#cb18-46" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb18-47"><a href="#cb18-47" aria-hidden="true" tabindex="-1"></a>  vers <span class="ot">&lt;-</span> ee_module<span class="sc">$</span><span class="st">`</span><span class="at">__version__</span><span class="st">`</span></span>
<span id="cb18-48"><a href="#cb18-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"ee __version__:"</span>, vers, <span class="st">" (type:"</span>, <span class="fu">typeof</span>(vers), <span class="st">")</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb18-49"><a href="#cb18-49" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb18-50"><a href="#cb18-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-51"><a href="#cb18-51" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Import NumPy</span></span>
<span id="cb18-52"><a href="#cb18-52" aria-hidden="true" tabindex="-1"></a>np_module <span class="ot">&lt;-</span> <span class="fu">try</span>(<span class="fu">import</span>(<span class="st">"numpy"</span>), <span class="at">silent =</span> <span class="cn">TRUE</span>)</span>
<span id="cb18-53"><a href="#cb18-53" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">inherits</span>(np_module, <span class="st">"try-error"</span>)) {</span>
<span id="cb18-54"><a href="#cb18-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Cannot import numpy.</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb18-55"><a href="#cb18-55" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb18-56"><a href="#cb18-56" aria-hidden="true" tabindex="-1"></a>  vers <span class="ot">&lt;-</span> np_module<span class="sc">$</span><span class="st">`</span><span class="at">__version__</span><span class="st">`</span></span>
<span id="cb18-57"><a href="#cb18-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"numpy __version__:"</span>, vers, <span class="st">" (type:"</span>, <span class="fu">typeof</span>(vers), <span class="st">")</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb18-58"><a href="#cb18-58" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb18-59"><a href="#cb18-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-60"><a href="#cb18-60" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Import pandas</span></span>
<span id="cb18-61"><a href="#cb18-61" aria-hidden="true" tabindex="-1"></a>pd_module <span class="ot">&lt;-</span> <span class="fu">try</span>(<span class="fu">import</span>(<span class="st">"pandas"</span>), <span class="at">silent =</span> <span class="cn">TRUE</span>)</span>
<span id="cb18-62"><a href="#cb18-62" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">inherits</span>(pd_module, <span class="st">"try-error"</span>)) {</span>
<span id="cb18-63"><a href="#cb18-63" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"annot import pandas.</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb18-64"><a href="#cb18-64" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb18-65"><a href="#cb18-65" aria-hidden="true" tabindex="-1"></a>  vers <span class="ot">&lt;-</span> pd_module<span class="sc">$</span><span class="st">`</span><span class="at">__version__</span><span class="st">`</span></span>
<span id="cb18-66"><a href="#cb18-66" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"pandas __version__:"</span>, vers, <span class="st">" (type:"</span>, <span class="fu">typeof</span>(vers), <span class="st">")</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb18-67"><a href="#cb18-67" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb18-68"><a href="#cb18-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-69"><a href="#cb18-69" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. Import six</span></span>
<span id="cb18-70"><a href="#cb18-70" aria-hidden="true" tabindex="-1"></a>six_module <span class="ot">&lt;-</span> <span class="fu">try</span>(<span class="fu">import</span>(<span class="st">"six"</span>), <span class="at">silent =</span> <span class="cn">TRUE</span>)</span>
<span id="cb18-71"><a href="#cb18-71" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">inherits</span>(six_module, <span class="st">"try-error"</span>)) {</span>
<span id="cb18-72"><a href="#cb18-72" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Cannot import six.</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb18-73"><a href="#cb18-73" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb18-74"><a href="#cb18-74" aria-hidden="true" tabindex="-1"></a>  vers <span class="ot">&lt;-</span> six_module<span class="sc">$</span><span class="st">`</span><span class="at">__version__</span><span class="st">`</span></span>
<span id="cb18-75"><a href="#cb18-75" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"six __version__:"</span>, vers, <span class="st">" (type:"</span>, <span class="fu">typeof</span>(vers), <span class="st">")</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb18-76"><a href="#cb18-76" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb18-77"><a href="#cb18-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-78"><a href="#cb18-78" aria-hidden="true" tabindex="-1"></a><span class="co"># Authenticate &amp; Initialize Google Earth Engine (first time opens a browser for OAuth)</span></span>
<span id="cb18-79"><a href="#cb18-79" aria-hidden="true" tabindex="-1"></a><span class="fu">ee_Authenticate</span>() <span class="co"># Paste the token in R console</span></span>
<span id="cb18-80"><a href="#cb18-80" aria-hidden="true" tabindex="-1"></a><span class="fu">ee_Initialize</span>() <span class="co"># If the folder already exists, press Esc to cancel the prompt</span></span>
<span id="cb18-81"><a href="#cb18-81" aria-hidden="true" tabindex="-1"></a><span class="fu">ee_Initialize</span>(<span class="at">user =</span> <span class="st">"account"</span>) <span class="co"># Manually set the user</span></span>
<span id="cb18-82"><a href="#cb18-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-83"><a href="#cb18-83" aria-hidden="true" tabindex="-1"></a><span class="co"># Manually create asset home (even though it exists—this call will simply confirm it)</span></span>
<span id="cb18-84"><a href="#cb18-84" aria-hidden="true" tabindex="-1"></a>ee<span class="sc">$</span>data<span class="sc">$</span><span class="fu">createAssetHome</span>(<span class="st">"users/account/newfolder"</span>)</span>
<span id="cb18-85"><a href="#cb18-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-86"><a href="#cb18-86" aria-hidden="true" tabindex="-1"></a><span class="co"># Verify that initialization succeeded</span></span>
<span id="cb18-87"><a href="#cb18-87" aria-hidden="true" tabindex="-1"></a><span class="fu">ee_user_info</span>()<span class="sc">$</span>assetRoots</span>
<span id="cb18-88"><a href="#cb18-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-89"><a href="#cb18-89" aria-hidden="true" tabindex="-1"></a><span class="co"># ee_clean_user_credentials() Remove any cached/expired token</span></span>
<span id="cb18-90"><a href="#cb18-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-91"><a href="#cb18-91" aria-hidden="true" tabindex="-1"></a><span class="co"># Confirm your GEE account</span></span>
<span id="cb18-92"><a href="#cb18-92" aria-hidden="true" tabindex="-1"></a><span class="fu">ee_user_info</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="o.3.-set-google-drive" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="o.3.-set-google-drive">O.3. Set Google drive</h3>
<div class="sourceCode" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"googledrive"</span>)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"googleCloudStorageR"</span>)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rgee)               <span class="co"># ee_Initialize() is already successfully set</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(googledrive)</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a><span class="co"># This will open a browser window prompting you to sign in with your Google drive account.</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a><span class="fu">drive_auth</span>() </span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a><span class="fu">drive_auth</span>(<span class="at">email =</span> <span class="st">"your_email@gmail.com"</span>) <span class="co"># if no window prompted, manually set the account</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Test R can access Drive</span></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a><span class="fu">drive_ls</span>(<span class="at">path =</span> <span class="fu">as_id</span>(<span class="st">"root"</span>), <span class="at">n_max =</span> <span class="dv">5</span>)</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a temporary file</span></span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>tmp <span class="ot">&lt;-</span> <span class="fu">tempfile</span>(<span class="at">fileext =</span> <span class="st">".txt"</span>)</span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a><span class="fu">writeLines</span>(<span class="st">"drive test"</span>, tmp)</span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Upload it to your Drive root</span></span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a><span class="fu">drive_upload</span>(<span class="at">media =</span> tmp, <span class="at">path =</span> <span class="fu">as_id</span>(<span class="st">"root"</span>), <span class="at">name =</span> <span class="st">"rgee_drive_test.txt"</span>)</span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Go to Google Drive to see if the text file exists</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="o.4.-to-run-gee-in-the-desired-python-path" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="o.4.-to-run-gee-in-the-desired-python-path">O.4. To run GEE in the desired python path</h3>
<div class="sourceCode" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>()) <span class="co"># clear R's workspace</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Make sure reticulate uses the correct Python (your gee-env)</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="fu">Sys.setenv</span>(<span class="at">RETICULATE_PYTHON =</span> <span class="st">"~/gee-env/bin/python"</span>)</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(reticulate)</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="fu">use_python</span>(<span class="st">"~/gee-env/bin/python"</span>, <span class="at">required =</span> <span class="cn">TRUE</span>)</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="fu">py_config</span>()</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Load rgee, initialize Earth Engine, specifying your existing asset home</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rgee)</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a><span class="fu">ee_Initialize</span>()</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Write the R code to perform the following task using RStudio: load the TIGER/Line shapefile, filter specifically for the state of Virginia, and calculate the mean land surface temperature within Virginia using MODIS data (Convert the previous JavaScript code into equivalent R code).</span></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Define Virginia boundary (FeatureCollection -&gt; Geometry)</span></span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>states     <span class="ot">&lt;-</span> ee<span class="sc">$</span><span class="fu">FeatureCollection</span>(<span class="st">"TIGER/2018/States"</span>)</span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>virginiaFc <span class="ot">&lt;-</span> states<span class="sc">$</span><span class="fu">filter</span>(ee<span class="sc">$</span>Filter<span class="sc">$</span><span class="fu">eq</span>(<span class="st">"NAME"</span>, <span class="st">"Virginia"</span>))</span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>virginia   <span class="ot">&lt;-</span> virginiaFc<span class="sc">$</span><span class="fu">geometry</span>()  <span class="co"># pure Geometry object of Virginia</span></span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Set the date range as ee$Date objects</span></span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a>startDate <span class="ot">&lt;-</span> ee<span class="sc">$</span><span class="fu">Date</span>(<span class="st">"2024-01-01"</span>)</span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a>endDate <span class="ot">&lt;-</span> ee<span class="sc">$</span><span class="fu">Date</span>(<span class="st">"2024-03-31"</span>)</span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Load daily MODIS Terra LST, select daytime band, filter by date and bounds</span></span>
<span id="cb20-25"><a href="#cb20-25" aria-hidden="true" tabindex="-1"></a>modis <span class="ot">&lt;-</span> ee<span class="sc">$</span><span class="fu">ImageCollection</span>(<span class="st">"MODIS/061/MOD11A1"</span>)<span class="sc">$</span></span>
<span id="cb20-26"><a href="#cb20-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="st">"LST_Day_1km"</span>)<span class="sc">$</span></span>
<span id="cb20-27"><a href="#cb20-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filterDate</span>(startDate, endDate)<span class="sc">$</span></span>
<span id="cb20-28"><a href="#cb20-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filterBounds</span>(virginia)</span>
<span id="cb20-29"><a href="#cb20-29" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb20-30"><a href="#cb20-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Define spatial scales</span></span>
<span id="cb20-31"><a href="#cb20-31" aria-hidden="true" tabindex="-1"></a>modisScale <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb20-32"><a href="#cb20-32" aria-hidden="true" tabindex="-1"></a>fineScale  <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb20-33"><a href="#cb20-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-34"><a href="#cb20-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Create high-resolution binary mask of Virginia</span></span>
<span id="cb20-35"><a href="#cb20-35" aria-hidden="true" tabindex="-1"></a>highResMask <span class="ot">&lt;-</span> ee<span class="sc">$</span>Image<span class="sc">$</span><span class="fu">constant</span>(<span class="dv">1</span>)<span class="sc">$</span></span>
<span id="cb20-36"><a href="#cb20-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">clip</span>(virginia)<span class="sc">$</span></span>
<span id="cb20-37"><a href="#cb20-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">reproject</span>(<span class="at">crs =</span> <span class="st">"EPSG:4326"</span>, <span class="at">scale =</span> fineScale)</span>
<span id="cb20-38"><a href="#cb20-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-39"><a href="#cb20-39" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute fractional overlap at MODIS scale</span></span>
<span id="cb20-40"><a href="#cb20-40" aria-hidden="true" tabindex="-1"></a>fracMask <span class="ot">&lt;-</span> highResMask<span class="sc">$</span></span>
<span id="cb20-41"><a href="#cb20-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">reduceResolution</span>(</span>
<span id="cb20-42"><a href="#cb20-42" aria-hidden="true" tabindex="-1"></a>    <span class="at">reducer =</span> ee<span class="sc">$</span>Reducer<span class="sc">$</span><span class="fu">mean</span>(),</span>
<span id="cb20-43"><a href="#cb20-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">maxPixels =</span> <span class="dv">1024</span></span>
<span id="cb20-44"><a href="#cb20-44" aria-hidden="true" tabindex="-1"></a>  )<span class="sc">$</span></span>
<span id="cb20-45"><a href="#cb20-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">reproject</span>(<span class="at">crs =</span> <span class="st">"EPSG:4326"</span>, <span class="at">scale =</span> modisScale)</span>
<span id="cb20-46"><a href="#cb20-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-47"><a href="#cb20-47" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply &gt;= 50% threshold to create binary inclusion mask</span></span>
<span id="cb20-48"><a href="#cb20-48" aria-hidden="true" tabindex="-1"></a>binaryMask <span class="ot">&lt;-</span> fracMask<span class="sc">$</span><span class="fu">gte</span>(<span class="fl">0.5</span>)</span>
<span id="cb20-49"><a href="#cb20-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-50"><a href="#cb20-50" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute number of whole weeks in the period (ceiling of difference in weeks)</span></span>
<span id="cb20-51"><a href="#cb20-51" aria-hidden="true" tabindex="-1"></a>n_weeks   <span class="ot">&lt;-</span> endDate<span class="sc">$</span><span class="fu">difference</span>(startDate, <span class="st">"week"</span>)<span class="sc">$</span><span class="fu">ceil</span>()<span class="sc">$</span><span class="fu">getInfo</span>()</span>
<span id="cb20-52"><a href="#cb20-52" aria-hidden="true" tabindex="-1"></a>weekList  <span class="ot">&lt;-</span> <span class="dv">0</span><span class="sc">:</span>(n_weeks <span class="sc">-</span> <span class="dv">1</span>)</span>
<span id="cb20-53"><a href="#cb20-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-54"><a href="#cb20-54" aria-hidden="true" tabindex="-1"></a><span class="co"># Map over each week index to compute weekly mean (°C) and package as a Feature</span></span>
<span id="cb20-55"><a href="#cb20-55" aria-hidden="true" tabindex="-1"></a>weeklyFeatures <span class="ot">&lt;-</span> <span class="fu">lapply</span>(weekList, <span class="cf">function</span>(i) {</span>
<span id="cb20-56"><a href="#cb20-56" aria-hidden="true" tabindex="-1"></a>  wkStart <span class="ot">&lt;-</span> startDate<span class="sc">$</span><span class="fu">advance</span>(i, <span class="st">"week"</span>)</span>
<span id="cb20-57"><a href="#cb20-57" aria-hidden="true" tabindex="-1"></a>  wkEnd   <span class="ot">&lt;-</span> wkStart<span class="sc">$</span><span class="fu">advance</span>(<span class="dv">1</span>, <span class="st">"week"</span>)</span>
<span id="cb20-58"><a href="#cb20-58" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb20-59"><a href="#cb20-59" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Compute mean image for the week</span></span>
<span id="cb20-60"><a href="#cb20-60" aria-hidden="true" tabindex="-1"></a>  wkMeanImage <span class="ot">&lt;-</span> modis<span class="sc">$</span></span>
<span id="cb20-61"><a href="#cb20-61" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filterDate</span>(wkStart, wkEnd)<span class="sc">$</span></span>
<span id="cb20-62"><a href="#cb20-62" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mean</span>()<span class="sc">$</span></span>
<span id="cb20-63"><a href="#cb20-63" aria-hidden="true" tabindex="-1"></a>    <span class="fu">multiply</span>(<span class="fl">0.02</span>)<span class="sc">$</span></span>
<span id="cb20-64"><a href="#cb20-64" aria-hidden="true" tabindex="-1"></a>    <span class="fu">subtract</span>(<span class="fl">273.15</span>)<span class="sc">$</span></span>
<span id="cb20-65"><a href="#cb20-65" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="st">"LST_mean_C"</span>)</span>
<span id="cb20-66"><a href="#cb20-66" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb20-67"><a href="#cb20-67" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Masked image using ≥50% inclusion</span></span>
<span id="cb20-68"><a href="#cb20-68" aria-hidden="true" tabindex="-1"></a>  maskedLST <span class="ot">&lt;-</span> wkMeanImage<span class="sc">$</span><span class="fu">updateMask</span>(binaryMask)</span>
<span id="cb20-69"><a href="#cb20-69" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb20-70"><a href="#cb20-70" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Reduce mean over valid region</span></span>
<span id="cb20-71"><a href="#cb20-71" aria-hidden="true" tabindex="-1"></a>  meanLST <span class="ot">&lt;-</span> maskedLST<span class="sc">$</span><span class="fu">reduceRegion</span>(</span>
<span id="cb20-72"><a href="#cb20-72" aria-hidden="true" tabindex="-1"></a>    <span class="at">reducer =</span> ee<span class="sc">$</span>Reducer<span class="sc">$</span><span class="fu">mean</span>(),</span>
<span id="cb20-73"><a href="#cb20-73" aria-hidden="true" tabindex="-1"></a>    <span class="at">geometry =</span> virginia,</span>
<span id="cb20-74"><a href="#cb20-74" aria-hidden="true" tabindex="-1"></a>    <span class="at">scale =</span> modisScale,</span>
<span id="cb20-75"><a href="#cb20-75" aria-hidden="true" tabindex="-1"></a>    <span class="at">maxPixels =</span> <span class="fl">1e13</span></span>
<span id="cb20-76"><a href="#cb20-76" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb20-77"><a href="#cb20-77" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb20-78"><a href="#cb20-78" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create feature with week metadata</span></span>
<span id="cb20-79"><a href="#cb20-79" aria-hidden="true" tabindex="-1"></a>  ee<span class="sc">$</span><span class="fu">Feature</span>(<span class="cn">NULL</span>, ee<span class="sc">$</span><span class="fu">Dictionary</span>(<span class="fu">list</span>(</span>
<span id="cb20-80"><a href="#cb20-80" aria-hidden="true" tabindex="-1"></a>    <span class="at">week_start =</span> wkStart<span class="sc">$</span><span class="fu">format</span>(<span class="st">"YYYY-MM-dd"</span>),</span>
<span id="cb20-81"><a href="#cb20-81" aria-hidden="true" tabindex="-1"></a>    <span class="at">week_end   =</span> wkEnd<span class="sc">$</span><span class="fu">format</span>(<span class="st">"YYYY-MM-dd"</span>),</span>
<span id="cb20-82"><a href="#cb20-82" aria-hidden="true" tabindex="-1"></a>    <span class="at">LST_mean_C =</span> meanLST<span class="sc">$</span><span class="fu">get</span>(<span class="st">"LST_mean_C"</span>)</span>
<span id="cb20-83"><a href="#cb20-83" aria-hidden="true" tabindex="-1"></a>  )))</span>
<span id="cb20-84"><a href="#cb20-84" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb20-85"><a href="#cb20-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-86"><a href="#cb20-86" aria-hidden="true" tabindex="-1"></a><span class="co"># Create FeatureCollection</span></span>
<span id="cb20-87"><a href="#cb20-87" aria-hidden="true" tabindex="-1"></a>weeklyFC <span class="ot">&lt;-</span> ee<span class="sc">$</span><span class="fu">FeatureCollection</span>(weeklyFeatures)</span>
<span id="cb20-88"><a href="#cb20-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-89"><a href="#cb20-89" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the results (Client-side view of the metadata)</span></span>
<span id="cb20-90"><a href="#cb20-90" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(weeklyFC<span class="sc">$</span><span class="fu">limit</span>(<span class="dv">5</span>)<span class="sc">$</span><span class="fu">getInfo</span>()) <span class="co"># Show the first five mean LST</span></span>
<span id="cb20-91"><a href="#cb20-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-92"><a href="#cb20-92" aria-hidden="true" tabindex="-1"></a><span class="co"># Export the FeatureCollection as a CSV to Google Drive</span></span>
<span id="cb20-93"><a href="#cb20-93" aria-hidden="true" tabindex="-1"></a>task <span class="ot">&lt;-</span> ee<span class="sc">$</span>batch<span class="sc">$</span>Export<span class="sc">$</span>table<span class="sc">$</span><span class="fu">toDrive</span>(</span>
<span id="cb20-94"><a href="#cb20-94" aria-hidden="true" tabindex="-1"></a>  <span class="at">collection =</span> weeklyFC,</span>
<span id="cb20-95"><a href="#cb20-95" aria-hidden="true" tabindex="-1"></a>  <span class="at">description =</span> <span class="st">"Virginia_Weekly_LST_Masked_JanMar2024"</span>,</span>
<span id="cb20-96"><a href="#cb20-96" aria-hidden="true" tabindex="-1"></a>  <span class="at">folder =</span> <span class="st">"rgee_exports"</span>,</span>
<span id="cb20-97"><a href="#cb20-97" aria-hidden="true" tabindex="-1"></a>  <span class="at">fileFormat =</span> <span class="st">"CSV"</span>,</span>
<span id="cb20-98"><a href="#cb20-98" aria-hidden="true" tabindex="-1"></a>  <span class="at">fileNamePrefix =</span> <span class="st">"Virginia_Weekly_LST_Masked_JanMar2024"</span></span>
<span id="cb20-99"><a href="#cb20-99" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb20-100"><a href="#cb20-100" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb20-101"><a href="#cb20-101" aria-hidden="true" tabindex="-1"></a><span class="co"># Export task</span></span>
<span id="cb20-102"><a href="#cb20-102" aria-hidden="true" tabindex="-1"></a>task<span class="sc">$</span><span class="fu">start</span>() <span class="co"># Can also click the task tab on GEE</span></span>
<span id="cb20-103"><a href="#cb20-103" aria-hidden="true" tabindex="-1"></a><span class="fu">ee_monitoring</span>(task) <span class="co"># Monitor task status</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="o.5.-use-rgee-inside-shiny-apps" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="o.5.-use-rgee-inside-shiny-apps">O.5. Use rgee inside Shiny apps</h3>
<p>To remotely compute the mean weekly MODIS land surface temperature (LST) over Virginia using the <code>rgee</code> package, and to display both the histogram and the computed weekly LST in an R Shiny app, you can use the following code. To enable automatic updates, set the end date to the most recent available MODIS observation using the <code>first()</code> function and calculate the start date accordingly. Make any modifications if you like.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">all =</span> <span class="cn">TRUE</span>))</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(shiny)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rgee)</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Set python environment and initialize Earth Engine</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="fu">Sys.setenv</span>(<span class="at">RETICULATE_PYTHON =</span> <span class="st">"~/gee-env/bin/python"</span>)</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(reticulate)</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a><span class="fu">use_python</span>(<span class="st">"~/gee-env/bin/python"</span>, <span class="at">required =</span> <span class="cn">TRUE</span>)</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a><span class="fu">py_config</span>()</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a><span class="fu">ee_Initialize</span>()</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare GEE Data -------------------------------------</span></span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a><span class="co"># (Similar as before, compute the mean LST within Virginia using MODIS data)</span></span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Virginia boundary</span></span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>states     <span class="ot">&lt;-</span> ee<span class="sc">$</span><span class="fu">FeatureCollection</span>(<span class="st">"TIGER/2018/States"</span>)</span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a>virginiaFc <span class="ot">&lt;-</span> states<span class="sc">$</span><span class="fu">filter</span>(ee<span class="sc">$</span>Filter<span class="sc">$</span><span class="fu">eq</span>(<span class="st">"NAME"</span>, <span class="st">"Virginia"</span>))</span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a>virginia   <span class="ot">&lt;-</span> virginiaFc<span class="sc">$</span><span class="fu">geometry</span>()</span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Date range</span></span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the latest available date in MODIS/061/MOD11A1</span></span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a>modis_latest_img <span class="ot">&lt;-</span> ee<span class="sc">$</span><span class="fu">ImageCollection</span>(<span class="st">"MODIS/061/MOD11A1"</span>)<span class="sc">$</span></span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sort</span>(<span class="st">"system:time_start"</span>, <span class="cn">FALSE</span>)<span class="sc">$</span></span>
<span id="cb21-26"><a href="#cb21-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">first</span>()</span>
<span id="cb21-27"><a href="#cb21-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-28"><a href="#cb21-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract date from the image metadata</span></span>
<span id="cb21-29"><a href="#cb21-29" aria-hidden="true" tabindex="-1"></a>endDate <span class="ot">&lt;-</span> ee<span class="sc">$</span><span class="fu">Date</span>(modis_latest_img<span class="sc">$</span><span class="fu">get</span>(<span class="st">"system:time_start"</span>))</span>
<span id="cb21-30"><a href="#cb21-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-31"><a href="#cb21-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Set startDate as 12 weeks (84 days) ago</span></span>
<span id="cb21-32"><a href="#cb21-32" aria-hidden="true" tabindex="-1"></a>startDate <span class="ot">&lt;-</span> endDate<span class="sc">$</span><span class="fu">advance</span>(<span class="sc">-</span><span class="dv">84</span>, <span class="st">"day"</span>)</span>
<span id="cb21-33"><a href="#cb21-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-34"><a href="#cb21-34" aria-hidden="true" tabindex="-1"></a><span class="co"># MODIS LST ImageCollection</span></span>
<span id="cb21-35"><a href="#cb21-35" aria-hidden="true" tabindex="-1"></a>modis <span class="ot">&lt;-</span> ee<span class="sc">$</span><span class="fu">ImageCollection</span>(<span class="st">"MODIS/061/MOD11A1"</span>)<span class="sc">$</span></span>
<span id="cb21-36"><a href="#cb21-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="st">"LST_Day_1km"</span>)<span class="sc">$</span></span>
<span id="cb21-37"><a href="#cb21-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filterDate</span>(startDate, endDate)<span class="sc">$</span></span>
<span id="cb21-38"><a href="#cb21-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filterBounds</span>(virginia)</span>
<span id="cb21-39"><a href="#cb21-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-40"><a href="#cb21-40" aria-hidden="true" tabindex="-1"></a><span class="co"># Scales</span></span>
<span id="cb21-41"><a href="#cb21-41" aria-hidden="true" tabindex="-1"></a>modisScale <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb21-42"><a href="#cb21-42" aria-hidden="true" tabindex="-1"></a>fineScale  <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb21-43"><a href="#cb21-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-44"><a href="#cb21-44" aria-hidden="true" tabindex="-1"></a><span class="co"># Binary mask using fractional overlap</span></span>
<span id="cb21-45"><a href="#cb21-45" aria-hidden="true" tabindex="-1"></a>highResMask <span class="ot">&lt;-</span> ee<span class="sc">$</span>Image<span class="sc">$</span><span class="fu">constant</span>(<span class="dv">1</span>)<span class="sc">$</span></span>
<span id="cb21-46"><a href="#cb21-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">clip</span>(virginia)<span class="sc">$</span></span>
<span id="cb21-47"><a href="#cb21-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">reproject</span>(<span class="at">crs =</span> <span class="st">"EPSG:4326"</span>, <span class="at">scale =</span> fineScale)</span>
<span id="cb21-48"><a href="#cb21-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-49"><a href="#cb21-49" aria-hidden="true" tabindex="-1"></a>fracMask <span class="ot">&lt;-</span> highResMask<span class="sc">$</span></span>
<span id="cb21-50"><a href="#cb21-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">reduceResolution</span>(<span class="at">reducer =</span> ee<span class="sc">$</span>Reducer<span class="sc">$</span><span class="fu">mean</span>(), <span class="at">maxPixels =</span> <span class="dv">1024</span>)<span class="sc">$</span></span>
<span id="cb21-51"><a href="#cb21-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">reproject</span>(<span class="at">crs =</span> <span class="st">"EPSG:4326"</span>, <span class="at">scale =</span> modisScale)</span>
<span id="cb21-52"><a href="#cb21-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-53"><a href="#cb21-53" aria-hidden="true" tabindex="-1"></a>binaryMask <span class="ot">&lt;-</span> fracMask<span class="sc">$</span><span class="fu">gte</span>(<span class="fl">0.5</span>)</span>
<span id="cb21-54"><a href="#cb21-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-55"><a href="#cb21-55" aria-hidden="true" tabindex="-1"></a><span class="co"># Get weekly results</span></span>
<span id="cb21-56"><a href="#cb21-56" aria-hidden="true" tabindex="-1"></a>n_weeks   <span class="ot">&lt;-</span> endDate<span class="sc">$</span><span class="fu">difference</span>(startDate, <span class="st">"week"</span>)<span class="sc">$</span><span class="fu">ceil</span>()<span class="sc">$</span><span class="fu">getInfo</span>()</span>
<span id="cb21-57"><a href="#cb21-57" aria-hidden="true" tabindex="-1"></a>weekList  <span class="ot">&lt;-</span> <span class="dv">0</span><span class="sc">:</span>(n_weeks <span class="sc">-</span> <span class="dv">1</span>)</span>
<span id="cb21-58"><a href="#cb21-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-59"><a href="#cb21-59" aria-hidden="true" tabindex="-1"></a>weeklyFeatures <span class="ot">&lt;-</span> <span class="fu">lapply</span>(weekList, <span class="cf">function</span>(i) {</span>
<span id="cb21-60"><a href="#cb21-60" aria-hidden="true" tabindex="-1"></a>  wkStart <span class="ot">&lt;-</span> startDate<span class="sc">$</span><span class="fu">advance</span>(i, <span class="st">"week"</span>)</span>
<span id="cb21-61"><a href="#cb21-61" aria-hidden="true" tabindex="-1"></a>  wkEnd   <span class="ot">&lt;-</span> wkStart<span class="sc">$</span><span class="fu">advance</span>(<span class="dv">1</span>, <span class="st">"week"</span>)</span>
<span id="cb21-62"><a href="#cb21-62" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-63"><a href="#cb21-63" aria-hidden="true" tabindex="-1"></a>  wkMeanImage <span class="ot">&lt;-</span> modis<span class="sc">$</span></span>
<span id="cb21-64"><a href="#cb21-64" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filterDate</span>(wkStart, wkEnd)<span class="sc">$</span></span>
<span id="cb21-65"><a href="#cb21-65" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mean</span>()<span class="sc">$</span></span>
<span id="cb21-66"><a href="#cb21-66" aria-hidden="true" tabindex="-1"></a>    <span class="fu">multiply</span>(<span class="fl">0.02</span>)<span class="sc">$</span></span>
<span id="cb21-67"><a href="#cb21-67" aria-hidden="true" tabindex="-1"></a>    <span class="fu">subtract</span>(<span class="fl">273.15</span>)<span class="sc">$</span></span>
<span id="cb21-68"><a href="#cb21-68" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="st">"LST_mean_C"</span>)</span>
<span id="cb21-69"><a href="#cb21-69" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-70"><a href="#cb21-70" aria-hidden="true" tabindex="-1"></a>  maskedLST <span class="ot">&lt;-</span> wkMeanImage<span class="sc">$</span><span class="fu">updateMask</span>(binaryMask)</span>
<span id="cb21-71"><a href="#cb21-71" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-72"><a href="#cb21-72" aria-hidden="true" tabindex="-1"></a>  meanLST <span class="ot">&lt;-</span> maskedLST<span class="sc">$</span><span class="fu">reduceRegion</span>(</span>
<span id="cb21-73"><a href="#cb21-73" aria-hidden="true" tabindex="-1"></a>    <span class="at">reducer =</span> ee<span class="sc">$</span>Reducer<span class="sc">$</span><span class="fu">mean</span>(),</span>
<span id="cb21-74"><a href="#cb21-74" aria-hidden="true" tabindex="-1"></a>    <span class="at">geometry =</span> virginia,</span>
<span id="cb21-75"><a href="#cb21-75" aria-hidden="true" tabindex="-1"></a>    <span class="at">scale =</span> modisScale,</span>
<span id="cb21-76"><a href="#cb21-76" aria-hidden="true" tabindex="-1"></a>    <span class="at">maxPixels =</span> <span class="fl">1e13</span></span>
<span id="cb21-77"><a href="#cb21-77" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb21-78"><a href="#cb21-78" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-79"><a href="#cb21-79" aria-hidden="true" tabindex="-1"></a>  ee<span class="sc">$</span><span class="fu">Feature</span>(<span class="cn">NULL</span>, ee<span class="sc">$</span><span class="fu">Dictionary</span>(<span class="fu">list</span>(</span>
<span id="cb21-80"><a href="#cb21-80" aria-hidden="true" tabindex="-1"></a>    <span class="at">week_start =</span> wkStart<span class="sc">$</span><span class="fu">format</span>(<span class="st">"YYYY-MM-dd"</span>),</span>
<span id="cb21-81"><a href="#cb21-81" aria-hidden="true" tabindex="-1"></a>    <span class="at">week_end   =</span> wkEnd<span class="sc">$</span><span class="fu">format</span>(<span class="st">"YYYY-MM-dd"</span>),</span>
<span id="cb21-82"><a href="#cb21-82" aria-hidden="true" tabindex="-1"></a>    <span class="at">LST_mean_C =</span> meanLST<span class="sc">$</span><span class="fu">get</span>(<span class="st">"LST_mean_C"</span>)</span>
<span id="cb21-83"><a href="#cb21-83" aria-hidden="true" tabindex="-1"></a>  )))</span>
<span id="cb21-84"><a href="#cb21-84" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb21-85"><a href="#cb21-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-86"><a href="#cb21-86" aria-hidden="true" tabindex="-1"></a>weeklyFC <span class="ot">&lt;-</span> ee<span class="sc">$</span><span class="fu">FeatureCollection</span>(weeklyFeatures)</span>
<span id="cb21-87"><a href="#cb21-87" aria-hidden="true" tabindex="-1"></a>weekly_df <span class="ot">&lt;-</span> weeklyFC<span class="sc">$</span><span class="fu">getInfo</span>()<span class="sc">$</span>features</span>
<span id="cb21-88"><a href="#cb21-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-89"><a href="#cb21-89" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to R data frame</span></span>
<span id="cb21-90"><a href="#cb21-90" aria-hidden="true" tabindex="-1"></a>lst_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb21-91"><a href="#cb21-91" aria-hidden="true" tabindex="-1"></a>  <span class="at">week_start =</span> <span class="fu">sapply</span>(weekly_df, <span class="cf">function</span>(f) f<span class="sc">$</span>properties<span class="sc">$</span>week_start),</span>
<span id="cb21-92"><a href="#cb21-92" aria-hidden="true" tabindex="-1"></a>  <span class="at">week_end   =</span> <span class="fu">sapply</span>(weekly_df, <span class="cf">function</span>(f) f<span class="sc">$</span>properties<span class="sc">$</span>week_end),</span>
<span id="cb21-93"><a href="#cb21-93" aria-hidden="true" tabindex="-1"></a>  <span class="at">LST_mean_C =</span> <span class="fu">sapply</span>(weekly_df, <span class="cf">function</span>(f) f<span class="sc">$</span>properties<span class="sc">$</span>LST_mean_C)</span>
<span id="cb21-94"><a href="#cb21-94" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb21-95"><a href="#cb21-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-96"><a href="#cb21-96" aria-hidden="true" tabindex="-1"></a>lst_df<span class="sc">$</span>week_start <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(lst_df<span class="sc">$</span>week_start)</span>
<span id="cb21-97"><a href="#cb21-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-98"><a href="#cb21-98" aria-hidden="true" tabindex="-1"></a><span class="co"># Shiny App -------------------------------------</span></span>
<span id="cb21-99"><a href="#cb21-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-100"><a href="#cb21-100" aria-hidden="true" tabindex="-1"></a>ui <span class="ot">&lt;-</span> <span class="fu">fluidPage</span>(</span>
<span id="cb21-101"><a href="#cb21-101" aria-hidden="true" tabindex="-1"></a>  <span class="fu">titlePanel</span>(<span class="st">"Weekly MODIS LST in Virginia (°C)"</span>),</span>
<span id="cb21-102"><a href="#cb21-102" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sidebarLayout</span>(</span>
<span id="cb21-103"><a href="#cb21-103" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sidebarPanel</span>(</span>
<span id="cb21-104"><a href="#cb21-104" aria-hidden="true" tabindex="-1"></a>      <span class="fu">selectInput</span>(<span class="st">"week"</span>, <span class="st">"Choose a Week:"</span>, <span class="at">choices =</span> lst_df<span class="sc">$</span>week_start)</span>
<span id="cb21-105"><a href="#cb21-105" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb21-106"><a href="#cb21-106" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mainPanel</span>(</span>
<span id="cb21-107"><a href="#cb21-107" aria-hidden="true" tabindex="-1"></a>      <span class="fu">verbatimTextOutput</span>(<span class="st">"selected_temp"</span>),</span>
<span id="cb21-108"><a href="#cb21-108" aria-hidden="true" tabindex="-1"></a>      <span class="fu">plotOutput</span>(<span class="st">"temp_plot"</span>)</span>
<span id="cb21-109"><a href="#cb21-109" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb21-110"><a href="#cb21-110" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb21-111"><a href="#cb21-111" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb21-112"><a href="#cb21-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-113"><a href="#cb21-113" aria-hidden="true" tabindex="-1"></a>server <span class="ot">&lt;-</span> <span class="cf">function</span>(input, output) {</span>
<span id="cb21-114"><a href="#cb21-114" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-115"><a href="#cb21-115" aria-hidden="true" tabindex="-1"></a>  output<span class="sc">$</span>selected_temp <span class="ot">&lt;-</span> <span class="fu">renderPrint</span>({</span>
<span id="cb21-116"><a href="#cb21-116" aria-hidden="true" tabindex="-1"></a>    row <span class="ot">&lt;-</span> lst_df[lst_df<span class="sc">$</span>week_start <span class="sc">==</span> input<span class="sc">$</span>week, ]</span>
<span id="cb21-117"><a href="#cb21-117" aria-hidden="true" tabindex="-1"></a>    <span class="fu">paste0</span>(<span class="st">"Mean Land Surface Temperature from "</span>, row<span class="sc">$</span>week_start,</span>
<span id="cb21-118"><a href="#cb21-118" aria-hidden="true" tabindex="-1"></a>           <span class="st">" to "</span>, row<span class="sc">$</span>week_end, <span class="st">": "</span>, <span class="fu">round</span>(row<span class="sc">$</span>LST_mean_C, <span class="dv">2</span>), <span class="st">" °C"</span>)</span>
<span id="cb21-119"><a href="#cb21-119" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb21-120"><a href="#cb21-120" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-121"><a href="#cb21-121" aria-hidden="true" tabindex="-1"></a>  output<span class="sc">$</span>temp_plot <span class="ot">&lt;-</span> <span class="fu">renderPlot</span>({</span>
<span id="cb21-122"><a href="#cb21-122" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(lst_df, <span class="fu">aes</span>(<span class="at">x =</span> week_start, <span class="at">y =</span> LST_mean_C)) <span class="sc">+</span></span>
<span id="cb21-123"><a href="#cb21-123" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_col</span>(<span class="at">fill =</span> <span class="st">"steelblue"</span>) <span class="sc">+</span></span>
<span id="cb21-124"><a href="#cb21-124" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Week Start"</span>, <span class="at">y =</span> <span class="st">"LST (°C)"</span>, <span class="at">title =</span> <span class="st">"Weekly Mean MODIS LST Over Virginia"</span>) <span class="sc">+</span></span>
<span id="cb21-125"><a href="#cb21-125" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme_minimal</span>()</span>
<span id="cb21-126"><a href="#cb21-126" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb21-127"><a href="#cb21-127" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb21-128"><a href="#cb21-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-129"><a href="#cb21-129" aria-hidden="true" tabindex="-1"></a><span class="fu">shinyApp</span>(ui, server)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="o.6.-connect-gee-data-with-nass-data" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="o.6.-connect-gee-data-with-nass-data">O.6. Connect GEE data with NASS data</h3>
<p>If the purpose of the project is to display both “Excellent” and “Good” corn conditions alongside mean LST data from MODIS for Virginia on a dashboard, we can first access NASS data through the API, filter for the specific corn conditions, and then merge the weekly corn condition data with the weekly mean LST.</p>
<p>Request for <a href="https://quickstats.nass.usda.gov/api?utm_source">NASS’s API Key</a>.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages("rnassqs")</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rnassqs)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tibble)</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Authenticate</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a><span class="fu">nassqs_auth</span>(<span class="at">key =</span> <span class="st">"Your_Own_API"</span>)</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the function</span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>crop_data <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">year =</span> <span class="dv">2025</span>) {</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> <span class="fu">nassqs</span>(<span class="fu">list</span>(</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">commodity_desc =</span> <span class="st">"CORN"</span>,</span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">year =</span> <span class="fu">as.character</span>(year),</span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">state_name =</span> <span class="st">"VIRGINIA"</span>,</span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">statisticcat_desc =</span> <span class="st">"CONDITION"</span>,</span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">agg_level_desc =</span> <span class="st">"STATE"</span></span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">nrow</span>(df) <span class="sc">==</span> <span class="dv">0</span>) <span class="fu">return</span>(<span class="cn">NULL</span>)</span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"PCT"</span>, unit_desc)) <span class="sc">%&gt;%</span>  <span class="co"># broader filter</span></span>
<span id="cb22-24"><a href="#cb22-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb22-25"><a href="#cb22-25" aria-hidden="true" tabindex="-1"></a>      <span class="at">week =</span> <span class="fu">as.Date</span>(week_ending),</span>
<span id="cb22-26"><a href="#cb22-26" aria-hidden="true" tabindex="-1"></a>      <span class="at">value =</span> <span class="fu">as.numeric</span>(Value),</span>
<span id="cb22-27"><a href="#cb22-27" aria-hidden="true" tabindex="-1"></a>      <span class="at">condition =</span> <span class="fu">case_when</span>(</span>
<span id="cb22-28"><a href="#cb22-28" aria-hidden="true" tabindex="-1"></a>        unit_desc <span class="sc">==</span> <span class="st">"PCT GOOD"</span> <span class="sc">~</span> <span class="st">"GOOD"</span>,</span>
<span id="cb22-29"><a href="#cb22-29" aria-hidden="true" tabindex="-1"></a>        unit_desc <span class="sc">==</span> <span class="st">"PCT EXCELLENT"</span> <span class="sc">~</span> <span class="st">"EXCELLENT"</span>,</span>
<span id="cb22-30"><a href="#cb22-30" aria-hidden="true" tabindex="-1"></a>        <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA_character_</span></span>
<span id="cb22-31"><a href="#cb22-31" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb22-32"><a href="#cb22-32" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb22-33"><a href="#cb22-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-34"><a href="#cb22-34" aria-hidden="true" tabindex="-1"></a>  <span class="co"># keep unique weeks</span></span>
<span id="cb22-35"><a href="#cb22-35" aria-hidden="true" tabindex="-1"></a>  all_weeks <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> <span class="fu">distinct</span>(week)</span>
<span id="cb22-36"><a href="#cb22-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-37"><a href="#cb22-37" aria-hidden="true" tabindex="-1"></a>  <span class="co"># keep only GOOD and EXCELLENT, pivot wider</span></span>
<span id="cb22-38"><a href="#cb22-38" aria-hidden="true" tabindex="-1"></a>  good_ex_data <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb22-39"><a href="#cb22-39" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(condition)) <span class="sc">%&gt;%</span></span>
<span id="cb22-40"><a href="#cb22-40" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(week, condition, value) <span class="sc">%&gt;%</span></span>
<span id="cb22-41"><a href="#cb22-41" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> condition, <span class="at">values_from =</span> value)</span>
<span id="cb22-42"><a href="#cb22-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-43"><a href="#cb22-43" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Join all weeks back in and fill missing values with 0</span></span>
<span id="cb22-44"><a href="#cb22-44" aria-hidden="true" tabindex="-1"></a>  full_data <span class="ot">&lt;-</span> <span class="fu">left_join</span>(all_weeks, good_ex_data, <span class="at">by =</span> <span class="st">"week"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb22-45"><a href="#cb22-45" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb22-46"><a href="#cb22-46" aria-hidden="true" tabindex="-1"></a>      <span class="at">GOOD =</span> <span class="fu">replace_na</span>(GOOD, <span class="dv">0</span>),</span>
<span id="cb22-47"><a href="#cb22-47" aria-hidden="true" tabindex="-1"></a>      <span class="at">EXCELLENT =</span> <span class="fu">replace_na</span>(EXCELLENT, <span class="dv">0</span>),</span>
<span id="cb22-48"><a href="#cb22-48" aria-hidden="true" tabindex="-1"></a>      <span class="at">good_excellent =</span> GOOD <span class="sc">+</span> EXCELLENT</span>
<span id="cb22-49"><a href="#cb22-49" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb22-50"><a href="#cb22-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-51"><a href="#cb22-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(full_data)</span>
<span id="cb22-52"><a href="#cb22-52" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb22-53"><a href="#cb22-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-54"><a href="#cb22-54" aria-hidden="true" tabindex="-1"></a>nass_clean <span class="ot">&lt;-</span> <span class="fu">crop_data</span>(<span class="dv">2025</span>)</span>
<span id="cb22-55"><a href="#cb22-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-56"><a href="#cb22-56" aria-hidden="true" tabindex="-1"></a><span class="co"># Inspect</span></span>
<span id="cb22-57"><a href="#cb22-57" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(nass_clean)</span>
<span id="cb22-58"><a href="#cb22-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-59"><a href="#cb22-59" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge two dataset</span></span>
<span id="cb22-60"><a href="#cb22-60" aria-hidden="true" tabindex="-1"></a>lst_df <span class="ot">&lt;-</span> lst_df <span class="sc">%&gt;%</span></span>
<span id="cb22-61"><a href="#cb22-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">week_end =</span> <span class="fu">as.Date</span>(week_end)) <span class="co"># Make sure same "Date" format</span></span>
<span id="cb22-62"><a href="#cb22-62" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb22-63"><a href="#cb22-63" aria-hidden="true" tabindex="-1"></a>merged_df <span class="ot">&lt;-</span> <span class="fu">left_join</span>(nass_clean, lst_df, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"week"</span> <span class="ot">=</span> <span class="st">"week_end"</span>)) <span class="co"># What might cause the NAs?</span></span>
<span id="cb22-64"><a href="#cb22-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-65"><a href="#cb22-65" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(nass_clean<span class="sc">$</span>week)</span>
<span id="cb22-66"><a href="#cb22-66" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(lst_df<span class="sc">$</span>week_end)</span>
<span id="cb22-67"><a href="#cb22-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-68"><a href="#cb22-68" aria-hidden="true" tabindex="-1"></a><span class="co"># Fix: Align lst_df$week_end to the nearest Sunday</span></span>
<span id="cb22-69"><a href="#cb22-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-70"><a href="#cb22-70" aria-hidden="true" tabindex="-1"></a>to_sunday <span class="ot">&lt;-</span> <span class="cf">function</span>(date) {</span>
<span id="cb22-71"><a href="#cb22-71" aria-hidden="true" tabindex="-1"></a>  date <span class="sc">-</span> <span class="fu">as.integer</span>(<span class="fu">format</span>(date, <span class="st">"%w"</span>))</span>
<span id="cb22-72"><a href="#cb22-72" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb22-73"><a href="#cb22-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-74"><a href="#cb22-74" aria-hidden="true" tabindex="-1"></a>lst_df_sun <span class="ot">&lt;-</span> lst_df <span class="sc">%&gt;%</span></span>
<span id="cb22-75"><a href="#cb22-75" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">week =</span> <span class="fu">to_sunday</span>(<span class="fu">as.Date</span>(week_end)))</span>
<span id="cb22-76"><a href="#cb22-76" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-77"><a href="#cb22-77" aria-hidden="true" tabindex="-1"></a>merged_df <span class="ot">&lt;-</span> <span class="fu">left_join</span>(nass_clean, lst_df_sun, <span class="at">by =</span> <span class="st">"week"</span>)</span>
<span id="cb22-78"><a href="#cb22-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-79"><a href="#cb22-79" aria-hidden="true" tabindex="-1"></a><span class="co"># Integrate the merged data into an R Shiny app ----------------------</span></span>
<span id="cb22-80"><a href="#cb22-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-81"><a href="#cb22-81" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(shiny)</span>
<span id="cb22-82"><a href="#cb22-82" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb22-83"><a href="#cb22-83" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb22-84"><a href="#cb22-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-85"><a href="#cb22-85" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure correct types</span></span>
<span id="cb22-86"><a href="#cb22-86" aria-hidden="true" tabindex="-1"></a>merged_df <span class="ot">&lt;-</span> merged_df <span class="sc">%&gt;%</span></span>
<span id="cb22-87"><a href="#cb22-87" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb22-88"><a href="#cb22-88" aria-hidden="true" tabindex="-1"></a>    <span class="at">week_char =</span> <span class="fu">as.character</span>(week),</span>
<span id="cb22-89"><a href="#cb22-89" aria-hidden="true" tabindex="-1"></a>    <span class="at">week =</span> <span class="fu">as.Date</span>(week)</span>
<span id="cb22-90"><a href="#cb22-90" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb22-91"><a href="#cb22-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-92"><a href="#cb22-92" aria-hidden="true" tabindex="-1"></a>ui <span class="ot">&lt;-</span> <span class="fu">fluidPage</span>(</span>
<span id="cb22-93"><a href="#cb22-93" aria-hidden="true" tabindex="-1"></a>  <span class="fu">titlePanel</span>(<span class="st">"Virginia Corn Condition vs. MODIS LST"</span>),</span>
<span id="cb22-94"><a href="#cb22-94" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-95"><a href="#cb22-95" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sidebarLayout</span>(</span>
<span id="cb22-96"><a href="#cb22-96" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sidebarPanel</span>(</span>
<span id="cb22-97"><a href="#cb22-97" aria-hidden="true" tabindex="-1"></a>      <span class="fu">sliderInput</span>(<span class="st">"week_range"</span>, <span class="st">"Select Week Range:"</span>,</span>
<span id="cb22-98"><a href="#cb22-98" aria-hidden="true" tabindex="-1"></a>                  <span class="at">min =</span> <span class="fu">min</span>(merged_df<span class="sc">$</span>week),</span>
<span id="cb22-99"><a href="#cb22-99" aria-hidden="true" tabindex="-1"></a>                  <span class="at">max =</span> <span class="fu">max</span>(merged_df<span class="sc">$</span>week),</span>
<span id="cb22-100"><a href="#cb22-100" aria-hidden="true" tabindex="-1"></a>                  <span class="at">value =</span> <span class="fu">c</span>(<span class="fu">min</span>(merged_df<span class="sc">$</span>week), <span class="fu">max</span>(merged_df<span class="sc">$</span>week)),</span>
<span id="cb22-101"><a href="#cb22-101" aria-hidden="true" tabindex="-1"></a>                  <span class="at">timeFormat =</span> <span class="st">"%Y-%m-%d"</span>),</span>
<span id="cb22-102"><a href="#cb22-102" aria-hidden="true" tabindex="-1"></a>      <span class="fu">checkboxInput</span>(<span class="st">"show_table"</span>, <span class="st">"Show data table"</span>, <span class="at">value =</span> <span class="cn">FALSE</span>)</span>
<span id="cb22-103"><a href="#cb22-103" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb22-104"><a href="#cb22-104" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb22-105"><a href="#cb22-105" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mainPanel</span>(</span>
<span id="cb22-106"><a href="#cb22-106" aria-hidden="true" tabindex="-1"></a>      <span class="fu">plotOutput</span>(<span class="st">"condition_plot"</span>),</span>
<span id="cb22-107"><a href="#cb22-107" aria-hidden="true" tabindex="-1"></a>      <span class="fu">conditionalPanel</span>(</span>
<span id="cb22-108"><a href="#cb22-108" aria-hidden="true" tabindex="-1"></a>        <span class="at">condition =</span> <span class="st">"input.show_table == true"</span>,</span>
<span id="cb22-109"><a href="#cb22-109" aria-hidden="true" tabindex="-1"></a>        <span class="fu">tableOutput</span>(<span class="st">"merged_table"</span>)</span>
<span id="cb22-110"><a href="#cb22-110" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb22-111"><a href="#cb22-111" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb22-112"><a href="#cb22-112" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb22-113"><a href="#cb22-113" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb22-114"><a href="#cb22-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-115"><a href="#cb22-115" aria-hidden="true" tabindex="-1"></a>server <span class="ot">&lt;-</span> <span class="cf">function</span>(input, output) {</span>
<span id="cb22-116"><a href="#cb22-116" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-117"><a href="#cb22-117" aria-hidden="true" tabindex="-1"></a>  filtered_data <span class="ot">&lt;-</span> <span class="fu">reactive</span>({</span>
<span id="cb22-118"><a href="#cb22-118" aria-hidden="true" tabindex="-1"></a>    merged_df <span class="sc">%&gt;%</span></span>
<span id="cb22-119"><a href="#cb22-119" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(week <span class="sc">&gt;=</span> input<span class="sc">$</span>week_range[<span class="dv">1</span>], week <span class="sc">&lt;=</span> input<span class="sc">$</span>week_range[<span class="dv">2</span>])</span>
<span id="cb22-120"><a href="#cb22-120" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb22-121"><a href="#cb22-121" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-122"><a href="#cb22-122" aria-hidden="true" tabindex="-1"></a>  output<span class="sc">$</span>condition_plot <span class="ot">&lt;-</span> <span class="fu">renderPlot</span>({</span>
<span id="cb22-123"><a href="#cb22-123" aria-hidden="true" tabindex="-1"></a>    df <span class="ot">&lt;-</span> <span class="fu">filtered_data</span>()</span>
<span id="cb22-124"><a href="#cb22-124" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb22-125"><a href="#cb22-125" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x =</span> week_char, <span class="at">group =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb22-126"><a href="#cb22-126" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> good_excellent), <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">size =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb22-127"><a href="#cb22-127" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> LST_mean_C <span class="sc">*</span> <span class="dv">2</span>), <span class="at">color =</span> <span class="st">"blue"</span>, <span class="at">size =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb22-128"><a href="#cb22-128" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_y_continuous</span>(</span>
<span id="cb22-129"><a href="#cb22-129" aria-hidden="true" tabindex="-1"></a>        <span class="at">name =</span> <span class="st">"Good + Excellent Condition (%)"</span>,</span>
<span id="cb22-130"><a href="#cb22-130" aria-hidden="true" tabindex="-1"></a>        <span class="at">sec.axis =</span> <span class="fu">sec_axis</span>(<span class="sc">~</span>.<span class="sc">/</span><span class="dv">2</span>, <span class="at">name =</span> <span class="st">"Mean LST (°C)"</span>)</span>
<span id="cb22-131"><a href="#cb22-131" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb22-132"><a href="#cb22-132" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(</span>
<span id="cb22-133"><a href="#cb22-133" aria-hidden="true" tabindex="-1"></a>        <span class="at">x =</span> <span class="st">"Week Ending"</span>,</span>
<span id="cb22-134"><a href="#cb22-134" aria-hidden="true" tabindex="-1"></a>        <span class="at">title =</span> <span class="st">"Weekly Corn Condition (Red) vs. MODIS LST (Blue) in Virginia"</span></span>
<span id="cb22-135"><a href="#cb22-135" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb22-136"><a href="#cb22-136" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb22-137"><a href="#cb22-137" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>))</span>
<span id="cb22-138"><a href="#cb22-138" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb22-139"><a href="#cb22-139" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-140"><a href="#cb22-140" aria-hidden="true" tabindex="-1"></a>  output<span class="sc">$</span>merged_table <span class="ot">&lt;-</span> <span class="fu">renderTable</span>({</span>
<span id="cb22-141"><a href="#cb22-141" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filtered_data</span>() <span class="sc">%&gt;%</span></span>
<span id="cb22-142"><a href="#cb22-142" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">week =</span> <span class="fu">as.character</span>(week)) <span class="sc">%&gt;%</span>  <span class="co"># Convert week to character</span></span>
<span id="cb22-143"><a href="#cb22-143" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(week, GOOD, EXCELLENT, good_excellent, LST_mean_C) <span class="sc">%&gt;%</span></span>
<span id="cb22-144"><a href="#cb22-144" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(week)</span>
<span id="cb22-145"><a href="#cb22-145" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb22-146"><a href="#cb22-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-147"><a href="#cb22-147" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb22-148"><a href="#cb22-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-149"><a href="#cb22-149" aria-hidden="true" tabindex="-1"></a><span class="fu">shinyApp</span>(ui, server)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="o.7.-connect-gee-data-with-acs-data" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="o.7.-connect-gee-data-with-acs-data">O.7. Connect GEE data with ACS data</h3>
<p>The purpose of the code below is to perform a spatial analysis of urban expansion and its relationship with housing characteristics within Montgomery County, Virginia. First, we retrieve detailed housing data (e.g., total units, occupancy, heating type, age of housing stock) for individual census tracts in Montgomery County.</p>
<p>Then we download the spatial boundary of Montgomery County from the US Census Bureau and convert it into a format usable by GEE. Next, we accesse <a href="https://developers.google.com/earth-engine/datasets/catalog/JRC_GHSL_P2023A_GHS_BUILT_S">Global Human Settlement Layer (GHSL)</a> for both 2015 and 2020, specifically focusing on the <code>built_surface</code> band, which serves as a proxy for urban development. By subtracting the 2015 built surface values from the 2020 values, we calculate the change in urbanized areas and export the change map to Google Drive.</p>
<p>Finally, we can combine these two datasets by loading the exported urban change raster, reprojecting the census tract geometries to match its coordinate system, and then extracting the mean urban change value for each census tract.</p>
<p>Request for <a href="https://api.census.gov/data/key_signup.html">U.S. Census Bureau’s API Key</a>.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">all =</span> <span class="cn">TRUE</span>))</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages(c("rgee", "sf", "tidycensus", "dplyr"))</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rgee)  </span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr) </span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)         <span class="co"># for spatial operations</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidycensus) <span class="co"># for ACS data</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>     </span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a><span class="fu">Sys.setenv</span>(<span class="at">RETICULATE_PYTHON =</span> <span class="st">"~/gee-env/bin/python"</span>)</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(reticulate)</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a><span class="fu">use_python</span>(<span class="st">"~/gee-env/bin/python"</span>, <span class="at">required =</span> <span class="cn">TRUE</span>)</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a><span class="fu">py_config</span>()</span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize Earth Engine</span></span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a><span class="fu">ee_Initialize</span>()</span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Census part ---------------------------------</span></span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Set your Census API key</span></span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a><span class="co"># census_api_key("Your_Own_API", install = TRUE)</span></span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Define variables (ACS 5-year 2020)</span></span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a>variables <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">total_units =</span> <span class="st">"B25001_001"</span>,</span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">occupied_units =</span> <span class="st">"B25002_002"</span>,</span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">vacant_units =</span> <span class="st">"B25002_003"</span>,</span>
<span id="cb23-26"><a href="#cb23-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">heating_gas =</span> <span class="st">"B25040_002"</span>,</span>
<span id="cb23-27"><a href="#cb23-27" aria-hidden="true" tabindex="-1"></a>  <span class="at">heating_electricity =</span> <span class="st">"B25040_003"</span>,</span>
<span id="cb23-28"><a href="#cb23-28" aria-hidden="true" tabindex="-1"></a>  <span class="at">built_before_1980 =</span> <span class="st">"B25034_006"</span>  <span class="co"># You can select multiple age bands</span></span>
<span id="cb23-29"><a href="#cb23-29" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb23-30"><a href="#cb23-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-31"><a href="#cb23-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Get tract-level data for Montgomery County, VA</span></span>
<span id="cb23-32"><a href="#cb23-32" aria-hidden="true" tabindex="-1"></a>va_housing <span class="ot">&lt;-</span> <span class="fu">get_acs</span>(</span>
<span id="cb23-33"><a href="#cb23-33" aria-hidden="true" tabindex="-1"></a>  <span class="at">geography =</span> <span class="st">"tract"</span>,</span>
<span id="cb23-34"><a href="#cb23-34" aria-hidden="true" tabindex="-1"></a>  <span class="at">variables =</span> variables,</span>
<span id="cb23-35"><a href="#cb23-35" aria-hidden="true" tabindex="-1"></a>  <span class="at">state =</span> <span class="st">"VA"</span>,</span>
<span id="cb23-36"><a href="#cb23-36" aria-hidden="true" tabindex="-1"></a>  <span class="at">county =</span> <span class="st">"Montgomery"</span>,</span>
<span id="cb23-37"><a href="#cb23-37" aria-hidden="true" tabindex="-1"></a>  <span class="at">year =</span> <span class="dv">2020</span>,</span>
<span id="cb23-38"><a href="#cb23-38" aria-hidden="true" tabindex="-1"></a>  <span class="at">geometry =</span> <span class="cn">TRUE</span></span>
<span id="cb23-39"><a href="#cb23-39" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb23-40"><a href="#cb23-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-41"><a href="#cb23-41" aria-hidden="true" tabindex="-1"></a><span class="co"># Reshape for usability</span></span>
<span id="cb23-42"><a href="#cb23-42" aria-hidden="true" tabindex="-1"></a>housing_data <span class="ot">&lt;-</span> va_housing <span class="sc">%&gt;%</span></span>
<span id="cb23-43"><a href="#cb23-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>moe) <span class="sc">%&gt;%</span></span>
<span id="cb23-44"><a href="#cb23-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">spread</span>(variable, estimate)</span>
<span id="cb23-45"><a href="#cb23-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-46"><a href="#cb23-46" aria-hidden="true" tabindex="-1"></a><span class="co"># RS part -----------------------------------</span></span>
<span id="cb23-47"><a href="#cb23-47" aria-hidden="true" tabindex="-1"></a><span class="co"># Download county boundary using tidycensus (sf object)</span></span>
<span id="cb23-48"><a href="#cb23-48" aria-hidden="true" tabindex="-1"></a>va_county <span class="ot">&lt;-</span> <span class="fu">get_acs</span>(</span>
<span id="cb23-49"><a href="#cb23-49" aria-hidden="true" tabindex="-1"></a>  <span class="at">geography =</span> <span class="st">"county"</span>,</span>
<span id="cb23-50"><a href="#cb23-50" aria-hidden="true" tabindex="-1"></a>  <span class="at">variables =</span> <span class="st">"B01003_001"</span>, <span class="co"># total population (example)</span></span>
<span id="cb23-51"><a href="#cb23-51" aria-hidden="true" tabindex="-1"></a>  <span class="at">state =</span> <span class="st">"VA"</span>,</span>
<span id="cb23-52"><a href="#cb23-52" aria-hidden="true" tabindex="-1"></a>  <span class="at">county =</span> <span class="st">"Montgomery"</span>,</span>
<span id="cb23-53"><a href="#cb23-53" aria-hidden="true" tabindex="-1"></a>  <span class="at">geometry =</span> <span class="cn">TRUE</span>,</span>
<span id="cb23-54"><a href="#cb23-54" aria-hidden="true" tabindex="-1"></a>  <span class="at">year =</span> <span class="dv">2020</span></span>
<span id="cb23-55"><a href="#cb23-55" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> </span>
<span id="cb23-56"><a href="#cb23-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="dv">4326</span>) <span class="co"># ensure it's in WGS84 (EPSG:4326)</span></span>
<span id="cb23-57"><a href="#cb23-57" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb23-58"><a href="#cb23-58" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert sf to ee object</span></span>
<span id="cb23-59"><a href="#cb23-59" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages("geojsonio")</span></span>
<span id="cb23-60"><a href="#cb23-60" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(geojsonio) </span>
<span id="cb23-61"><a href="#cb23-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-62"><a href="#cb23-62" aria-hidden="true" tabindex="-1"></a><span class="co"># Keep Only Geometry</span></span>
<span id="cb23-63"><a href="#cb23-63" aria-hidden="true" tabindex="-1"></a>va_county_geom <span class="ot">&lt;-</span> va_county <span class="sc">%&gt;%</span> </span>
<span id="cb23-64"><a href="#cb23-64" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(geometry)</span>
<span id="cb23-65"><a href="#cb23-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-66"><a href="#cb23-66" aria-hidden="true" tabindex="-1"></a>montgomery_ee <span class="ot">&lt;-</span> <span class="fu">sf_as_ee</span>(va_county_geom)</span>
<span id="cb23-67"><a href="#cb23-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-68"><a href="#cb23-68" aria-hidden="true" tabindex="-1"></a><span class="co"># Get GHSL 2015 and 2020 impervious surfaces (urban indicator)</span></span>
<span id="cb23-69"><a href="#cb23-69" aria-hidden="true" tabindex="-1"></a>built_2015 <span class="ot">&lt;-</span> ee<span class="sc">$</span><span class="fu">Image</span>(<span class="st">"JRC/GHSL/P2023A/GHS_BUILT_S/2015"</span>)<span class="sc">$</span><span class="fu">select</span>(<span class="st">"built_surface"</span>)</span>
<span id="cb23-70"><a href="#cb23-70" aria-hidden="true" tabindex="-1"></a>built_2020 <span class="ot">&lt;-</span> ee<span class="sc">$</span><span class="fu">Image</span>(<span class="st">"JRC/GHSL/P2023A/GHS_BUILT_S/2020"</span>)<span class="sc">$</span><span class="fu">select</span>(<span class="st">"built_surface"</span>)</span>
<span id="cb23-71"><a href="#cb23-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-72"><a href="#cb23-72" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate difference to estimate urban expansion</span></span>
<span id="cb23-73"><a href="#cb23-73" aria-hidden="true" tabindex="-1"></a>urban_change <span class="ot">&lt;-</span> built_2020<span class="sc">$</span><span class="fu">subtract</span>(built_2015)</span>
<span id="cb23-74"><a href="#cb23-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-75"><a href="#cb23-75" aria-hidden="true" tabindex="-1"></a><span class="co"># Reduce Image Over County, Mean impervious surface change in the county</span></span>
<span id="cb23-76"><a href="#cb23-76" aria-hidden="true" tabindex="-1"></a>urban_stats <span class="ot">&lt;-</span> urban_change<span class="sc">$</span><span class="fu">reduceRegion</span>(</span>
<span id="cb23-77"><a href="#cb23-77" aria-hidden="true" tabindex="-1"></a>  <span class="at">reducer =</span> ee<span class="sc">$</span>Reducer<span class="sc">$</span><span class="fu">mean</span>(),</span>
<span id="cb23-78"><a href="#cb23-78" aria-hidden="true" tabindex="-1"></a>  <span class="at">geometry =</span> montgomery_ee<span class="sc">$</span><span class="fu">geometry</span>(),</span>
<span id="cb23-79"><a href="#cb23-79" aria-hidden="true" tabindex="-1"></a>  <span class="at">scale =</span> <span class="dv">30</span>,</span>
<span id="cb23-80"><a href="#cb23-80" aria-hidden="true" tabindex="-1"></a>  <span class="at">maxPixels =</span> <span class="fl">1e13</span></span>
<span id="cb23-81"><a href="#cb23-81" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb23-82"><a href="#cb23-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-83"><a href="#cb23-83" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the result</span></span>
<span id="cb23-84"><a href="#cb23-84" aria-hidden="true" tabindex="-1"></a>urban_stats<span class="sc">$</span><span class="fu">getInfo</span>()</span>
<span id="cb23-85"><a href="#cb23-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-86"><a href="#cb23-86" aria-hidden="true" tabindex="-1"></a><span class="co"># Export to Google Drive</span></span>
<span id="cb23-87"><a href="#cb23-87" aria-hidden="true" tabindex="-1"></a>task <span class="ot">&lt;-</span> <span class="fu">ee_image_to_drive</span>(</span>
<span id="cb23-88"><a href="#cb23-88" aria-hidden="true" tabindex="-1"></a>  <span class="at">image =</span> urban_change,</span>
<span id="cb23-89"><a href="#cb23-89" aria-hidden="true" tabindex="-1"></a>  <span class="at">description =</span> <span class="st">'urban_change_montgomery_5'</span>,</span>
<span id="cb23-90"><a href="#cb23-90" aria-hidden="true" tabindex="-1"></a>  <span class="at">folder =</span> <span class="st">'GEE_exports'</span>,</span>
<span id="cb23-91"><a href="#cb23-91" aria-hidden="true" tabindex="-1"></a>  <span class="at">fileNamePrefix =</span> <span class="st">'urban_change_5y_montgomery'</span>,</span>
<span id="cb23-92"><a href="#cb23-92" aria-hidden="true" tabindex="-1"></a>  <span class="at">region =</span> montgomery_ee<span class="sc">$</span><span class="fu">geometry</span>(),</span>
<span id="cb23-93"><a href="#cb23-93" aria-hidden="true" tabindex="-1"></a>  <span class="at">scale =</span> <span class="dv">100</span></span>
<span id="cb23-94"><a href="#cb23-94" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb23-95"><a href="#cb23-95" aria-hidden="true" tabindex="-1"></a>task<span class="sc">$</span><span class="fu">start</span>()</span>
<span id="cb23-96"><a href="#cb23-96" aria-hidden="true" tabindex="-1"></a><span class="fu">ee_monitoring</span>(task) </span>
<span id="cb23-97"><a href="#cb23-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-98"><a href="#cb23-98" aria-hidden="true" tabindex="-1"></a><span class="co"># Load Raster Map and Reproject ACS data -----------------------</span></span>
<span id="cb23-99"><a href="#cb23-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-100"><a href="#cb23-100" aria-hidden="true" tabindex="-1"></a><span class="co"># Load urban expansion raster, download the Raster map locally</span></span>
<span id="cb23-101"><a href="#cb23-101" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(terra)</span>
<span id="cb23-102"><a href="#cb23-102" aria-hidden="true" tabindex="-1"></a>urban_raster <span class="ot">&lt;-</span> <span class="fu">rast</span>(<span class="st">"figures/urban_change_5y_montgomery.tif"</span>)</span>
<span id="cb23-103"><a href="#cb23-103" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(urban_raster, <span class="at">main =</span> <span class="st">"Urban Change in Montgomery County"</span>)</span>
<span id="cb23-104"><a href="#cb23-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-105"><a href="#cb23-105" aria-hidden="true" tabindex="-1"></a><span class="co"># Reproject ACS geometries to match raster CRS</span></span>
<span id="cb23-106"><a href="#cb23-106" aria-hidden="true" tabindex="-1"></a>housing_data_proj <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(housing_data, <span class="at">crs =</span> <span class="fu">crs</span>(urban_raster))</span>
<span id="cb23-107"><a href="#cb23-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-108"><a href="#cb23-108" aria-hidden="true" tabindex="-1"></a><span class="co"># Now you can extract zonal stats</span></span>
<span id="cb23-109"><a href="#cb23-109" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(exactextractr)</span>
<span id="cb23-110"><a href="#cb23-110" aria-hidden="true" tabindex="-1"></a>housing_data_proj<span class="sc">$</span>urban_change_mean <span class="ot">&lt;-</span> <span class="fu">exact_extract</span>(urban_raster, housing_data_proj, <span class="st">'mean'</span>)</span>
<span id="cb23-111"><a href="#cb23-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-112"><a href="#cb23-112" aria-hidden="true" tabindex="-1"></a><span class="co"># Save to GeoPackage or CSV</span></span>
<span id="cb23-113"><a href="#cb23-113" aria-hidden="true" tabindex="-1"></a><span class="fu">st_write</span>(housing_data_proj, <span class="st">"montgomery_housing_urban.gpkg"</span>)</span>
<span id="cb23-114"><a href="#cb23-114" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(<span class="fu">st_drop_geometry</span>(housing_data_proj), <span class="st">"montgomery_housing_urban.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>